seajs.use(["~speed@1","~paging@1","~url@1","~box@1.x","~template@3","~lazyload@1","~pagelet@1"],function(e,t,a,r,i){var n=new r,s="sel-form-li-show",l="sel-form-at",o="sel-form-li-none",d="fn-hide",_="list-sel-form-more",c="on",u="on_desc",f="on_asc",g=null,m={},h=8,p=0,y={"default":0,sales_desc:"sales_desc",price_asc:"price_asc",price_desc:"price_desc"},v=["category_id_2","category_id_3","brand_id","amount","feature_id_1","feature_id_2","feature_id_3"],C={category_id_2:0,category_id_3:0,brand_id:0,amount:0,feature_id_1:0,feature_id_2:0,feature_id_3:0},b="",L={getHashParam:function(){var e=window.location.hash.toString().replace(/^#+/,""),t=/^\!/.test(e),a="";if(t&&e.substr(1)){var r=e.substr(1),a=r.split("/");a.shift();var i=a.length;a=a.concat(new Array(h-i+1).join("0").split(""))}return a},renderBrandHeight:function(){var e=$("#brand_wrap"),t=$("#brand_line"),a=t.data("line-height");e.addClass(s);var r=t.height();r>2*a?(e.removeClass(s).removeClass(o),t.addClass(l)):r==a?(e.removeClass("G_CLS_FOLD_UP_BTN").addClass(o),t.removeClass(l)):(e.removeClass("G_CLS_FOLD_UP_BTN").addClass(o),t.addClass(l))},renderPageBar:function(e){var a=this,r={page:1,totalNum:1,totalPage:1,isAjax:!0,onClick:function(e){$("#current_page").html(e),a.querySkuList({page:e,scrolling:!0})}},i=new t($.extend(r,e));$("#current_page").html(1),$("#total_num").html(r.totalNum),$("#total_page").html(r.totalPage),i.render("#pagebar")},querySkuList:function(e){var t=this,a=e||{},r="/product/get_more.json",i={},s=$.trim($("#left_amount").val()),l=$.trim($("#right_amount").val());C?$.each(C,function(e,t){i[e]=t}):$.each($(".js-filter-line"),function(e,t){var a=$(t),r=a.data("type"),n=a.find(".js-filter-item."+c);i[r]=n.data("id")||0}),i.category_id_1=G_CATEGORY_ID_1,b&&(i.sort=b),s&&(i.left_amount=s),l&&(i.right_amount=l),i.page=a.page||1,$.post(r,i,function(e){var r=e.retcode,i=e.retmsg;if(0==r){var s=e.html,l=$("#sku_list");if($("#show_loading").addClass(d),l.html(s),p=e.total_num>0?1:0,1==a.scrolling){var o=l.offset().top;$("html, body").animate({scrollTop:o-40},700,"swing",function(){setTimeout(function(){t.bindlazyload("#sku_list")},0)})}else t.bindlazyload("#sku_list");1==a.rebuildPageBar&&t.renderPageBar({totalNum:e.total_num,totalPage:e.total_page}),t.bindBanbangoEvent()}else n.showError(r,i)})},queryFilterList:function(e,t){var a=this,r="/product/query_filter_list.json";if(m[e])a.renderBrand(t,e,m[e]),a.renderFilterItemByHash();else{0==e&&G_CATEGORY_ID_1&&(e=G_CATEGORY_ID_1,t="category_id_1");var i={line_type:t,category_id:e};"category_id_2"==t&&(i.category_id_1=G_CATEGORY_ID_1),$.get(r,i,function(r){var i=r.retcode,s=r.retmsg;0==i?(a.renderBrand(t,e,r),a.renderFilterItemByHash(),m[e]=r):n.showError(i,s)},"json")}},renderBrand:function(e,t,a){var r=this,n=$(".js-category3");$("#brand_list").html(i("tpl_filter_brand",{list:a.brand_list})),r.renderBrandHeight(),"category_id_2"==e&&(a.is_show_category3?(n.removeClass(d),r.renderCategory3(a.category3_list)):n.addClass(d))},renderCategory3:function(e){$("#category_3_list").html(i("tpl_filter_category3",{list:e}))},renderFilterItemByHash:function(){var e=this,t=e.getHashParam(),a="";""!=t&&$.each(t,function(e,t){if(v[e]){var r=$('.js-filter-line[data-type="'+v[e]+'"]'),n=r.find('[data-id="'+t+'"]'),s=r.find(".js-filter-item");s.removeClass(c),n.addClass(c),a=0!=t&&s.length>1&&n.html()?i("tpl_nav_tab",{text:n.html(),filter_type:v[e]}):"",$("#nav_tab_"+v[e]).html(a),C[v[e]]=t}})},renderHashParams:function(){var e="";$.each(C,function(t,a){e+="/"+a}),e=e.replace(/(\/0)+$/,""),window.location.hash="#!"+e},bindlazyload:function(e){$(e+" img[data-original]").lazyload({effect:"fadeIn"})},bindFilterItemEvent:function(e,t){var a=this;switch(e){case"amount":$("#left_amount").val(""),$("#right_amount").val(""),C.amount=t;break;case"category_id_2":"0"==t?($(".js-category3").addClass(d),a.queryFilterList(t,"category_id_1")):a.queryFilterList(t,"category_id_2"),$.each(C,function(e){C[e]=0});break;case"category_id_3":if("0"==t){var r=$("#category_2_line").find(".js-filter-item."+c).data("id");a.queryFilterList(r,"category_id_2")}else a.queryFilterList(t,"category_id_3");C.brand_id=0}},bindEvent:function(){var e=this,t=$("#brand_wrap"),a=$("#filter_box");$("#base_brand").on("click",function(e){e.preventDefault(),t.removeClass(s)}),$("#more_brand").on("click",function(e){e.preventDefault(),t.addClass(s)}),$("#base_filter").on("click",function(e){e.preventDefault(),a.removeClass(_)}),$("#more_filter").on("click",function(e){e.preventDefault(),a.addClass(_)}),a.on("click",".js-filter-item",function(t){t.preventDefault();var a=$(this),r=a.parents(".js-filter-line"),n="",s=a.data("id"),l=r.data("type")||"";return a.hasClass(c)?!1:(FQL.Stat.clickStat("CHANNEL.PRODUCT.LIST."+l.toUpperCase()),r.find(".js-filter-item").removeClass(c),a.addClass(c),g=setTimeout(function(){e.querySkuList({page:1,rebuildPageBar:!0})},200),0!=s&&(n=i("tpl_nav_tab",{text:a.html(),filter_type:l})),$("#nav_tab_"+l).html(n),e.bindFilterItemEvent(l,s),l in C&&(C[l]=s),void e.renderHashParams())}),$("body").on("click",".js-nav-tab",function(t){t.preventDefault();var a=$(this),r=a.data("type"),i=$('.js-filter-line[data-type="'+r+'"]').find(".js-filter-item");FQL.Stat.clickStat("CHANNEL.PRODUCT.LIST."+r.toUpperCase()),$("#nav_tab_"+r).html(""),i.removeClass(c),i.eq(0).addClass(c),r in C&&(C[r]=0),e.renderHashParams(),e.querySkuList({page:1,rebuildPageBar:!0}),e.bindFilterItemEvent(r,0)}),$("#btn_search").on("click",function(t){t.preventDefault();var a=$("#filter_line_amount .js-filter-item");a.removeClass(c),a.eq(0).addClass(c),C.amount=0,e.renderHashParams(),e.querySkuList({page:1,rebuildPageBar:!0})}),$(".js-sort-bar").on("click",function(t){t.preventDefault();var a=$(this),r=a.data("type");if(a.hasClass(c)&&"price"!=r)return!1;switch($(".js-sort-bar").removeClass(c).removeClass(f).removeClass(u),a.addClass(c),r){case"price":b==y.price_desc?(b=y.price_asc,a.addClass(f),FQL.Stat.clickStat("CHANNEL.PRODUCT.LIST.PRICE_ASC")):(a.addClass(u),b=y.price_desc,FQL.Stat.clickStat("CHANNEL.PRODUCT.LIST.PRICE_DESC"));break;case"sales":a.addClass(u),b=y.sales_desc,FQL.Stat.clickStat("CHANNEL.PRODUCT.LIST.SALES_DESC");break;default:b="",FQL.Stat.clickStat("CHANNEL.PRODUCT.LIST.DEFAULT_SORT")}e.querySkuList({page:1,rebuildPageBar:!0})}),$(window).on("hashchange",function(){e.renderFilterItemByHash(),"undefined"!=typeof g&&g&&clearTimeout(g),e.querySkuList({page:1,rebuildPageBar:!0})}),$(".js-history-list").on("pagelet-lazyload-onload",function(){e.bindlazyload(".js-history-list")}),$(".js-bangbanggou").on("pagelet-lazyload-onload",function(){e.bindBanbangoEvent()})},bindBanbangoEvent:function(){p?$("#banbango").removeClass(d):$("#banbango").addClass(d)},bindError:function(){var e=FQL.ErrorLogger.getLogger("product_list");e.bindError("912320001")},sendSpeed:function(){new e({domainId:23,pageId:2,timePoint:G_SPEED_POINT_TIME})},initInfoByHashParam:function(){var e=this.getHashParam();e&&($.each(e,function(e,t){C[v[e]]=t}),this.queryFilterList(C.category_id_2,"category_id_2")),this.querySkuList({page:1,rebuildPageBar:!0})},initParams:function(){$.each(G_ROUTE_PARAMS,function(e,t){e in C&&(C[e]=t)}),this.initInfoByHashParam(),this.renderBrandHeight(),this.bindlazyload(".list-hot-li")},init:function(){G_SPEED_POINT_TIME.LOGIC={ID:5,DATA:[G_PAGE_LOAD_TIME,(new Date).getTime()]},this.initParams(),this.bindError(),this.bindEvent(),this.sendSpeed()}};L.init()});
//# sourceMappingURL=//channel.fenqile.com/res/static/product/list.js.map