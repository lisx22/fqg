seajs.use(["~form@1","~url@1","~md5@1","~countdown_button@1","~box@1","~behavior@1"],function(e,r,s,t,i,o){var n="fn-hide",a="btn-disabled",c="form-error",d=r.get("url"),l=!1,m=!1,g=new i,u=null,p=new o,v={submit:function(e){$.post("/register/submit.json",e,function(e){var s=parseInt(e.retcode,10),t=e.retmsg;if(0==s){try{p.triggerBehaviorDataUpload({is_success:1})}catch(e){}setTimeout(function(){location.href=r.check(d)?d:"/register/result.html"},150)}else g.showError(s,t),p.triggerBehaviorDataUpload({is_success:0})},"json","#register_btn")},sendSmsCode:function(e){$.post("/register/send_sms_code.json",e,function(e){var r=parseInt(e.retcode,10),s=e.retmsg;0!=r&&(g.showError(r,s),u.endCountdown(),$("#refresh_imgcode").trigger("click"))})},checkMobile:function(){var e=$("#mobile").val().replace(/\s/g,""),r=$("#sms_code").val(),s="/register/check_mobile.json",t={mobile:e,sms_code:r},i=this;e&&$.post(s,t,function(e){var r=parseInt(e.retcode,10),s=e.retmsg;switch(r){case 0:m=!0,l=!1;break;case 901221001:l=!0,i.showErrorMsg("#mobile",s);break;default:m=!1,i.showErrorMsg("#sms_code",s)}})},showErrorMsg:function(e,r){var s=$(e).closest(".js-input-wrap"),t=s.find(".js-input-msg"),i='<div class="fl tips js-input-msg">'+r+"</div>";0==t.length&&s.addClass(c).append(i)},removeMobileErrorMsg:function(){var e=$("#mobile").closest(".js-input-wrap"),r=e.find(".js-input-msg");e.removeClass(c),r.remove()},bindEvent:function(){var r=this;$("#mobile").on("input",function(e){var r=$("#mobile").val();e.preventDefault(),11==r.length&&$("#img_code_wrap").removeClass(n)}),$("#refresh_imgcode").on("click",function(e){e.preventDefault(),$(this).attr("src","/getimage?r="+Math.random()),$("#imgcode").val("")});var i=new e("#submit_form");i.setInteractiveHandler(function(e){$.each(e.elementList,function(e,r){r.closest(".js-input-wrap").removeClass(c).find(".js-input-msg").remove()}),$.each(e.errorInfoList,function(e,r){var s='<div class="fl tips js-input-msg">'+r.message+"</div>";r.element.closest(".js-input-wrap").addClass(c).append(s)})}),$("#sms_code").on("change",function(){r.checkMobile()}),$("#register_btn").on("click",function(e){if(e.preventDefault(),i.validate()&&!l&&m){var t=i.serializeObject();t.passwd=s(t.passwd),t.pay_pwd=s(t.pay_pwd),r.submit(t)}}),u=new t($("#get_sms_code"),{clickHandler:function(e){var s=$('[name="imgcode"]'),t="/register/anti_fraud_anti_register.json",o={mobile:$("#mobile").val()};return i.validate("#mobile")?s.val()?void $.post(t,o,function(e){0===parseInt(e.retcode,10)?1==e.is_anti_register?g.showError(e.anti_register_code,e.anti_register_msg):r.sendSmsCode({mobile:$("#mobile").val(),imgcode:s.val()}):g.showError(e.retcode,e.retmsg)}):(e.ret=!1,void r.showErrorMsg("#imgcode","图片验证码不能为空")):void(e.ret=!1)}}),$("#agreement").on("click",function(){$(this).prop("checked")?$("#register_btn").removeClass(a).prop("disabled",!1):$("#register_btn").addClass(a).prop("disabled",!0)}),$("#passwd, #pay_pwd").on("focus",function(){$(this).parents(".js-input-wrap").next().removeClass(n)})},bindError:function(){var e=FQL.ErrorLogger.getLogger("register");e.bindError("910820003")},init:function(){this.bindEvent(),this.bindError()}};v.init()});