seajs.use(["~template@3","~box@1","~paging@1","~frame_host@1.x"],function(e,t,r,a){var o=FQL.box,n="",i="on",d="fn-hide",l={},c="",s=$("#loading_tpl").html(),h="all",u=!1;window.G_IS_REFRESH=0;var p=function(e){var t="/order/query_order_list.json",r={state_filter:n,page:e};u=!0,$.post(t,r,function(t){var r=parseInt(t.retcode,10),a=t.retmsg;switch(r){case 0:t.page_num=e,l[h+"_"+e]=t,f.renderOrderList({data:t,is_need_render_pagebar:1==e?1:0}),u=!1;break;default:o.showError(r,a),u=!1}},"json")};window.G_VERIFY_PAY_PWD_CALLBACK=function(e){f.popOrderConfirm(e.pay_pwd)};var f={renderOrderList:function(t){var r=t.data;r.window=window;var a=e("list_wrap_tpl",r);$("#order_list_wrap").html(a),$("body").animate({scrollTop:0},500),1==t.is_need_render_pagebar&&r.order_list.length>0&&this.renderPageBar(r),seajs.use(["~tooltip@1"],function(e){$("body").find(".js-tooltip").each(function(){new e($(this))})})},renderPageBar:function(e){var t=this,a=new r({page:e.page_num,totalPage:e.max_page,totalNum:e.total_num,isAjax:!0,onClick:function(e){var r=l[h+"_"+e];r?t.renderOrderList({data:r,is_need_render_pagebar:0}):p(e)}});a.render("#pager_bar")},queryOrderTrack:function(e,t){var r=this,a="/order/get_track.json";u=!0,$.post(a,t,function(t){var a=parseInt(t.retcode,10),n=t.retmsg;switch(a){case 0:r.renderTrackInfo(e,t),u=!1;break;default:o.showError(a,n),u=!1}},"json")},renderTrackInfo:function(t,r){var a=e("order_step_tpl",r);r.track_info.length>0?t.html(a).attr("data-init","1"):t.html("暂无数据")},popOrderConfirm:function(e){var t="/order/pop_order_confirm.json",r={order_id:c,pay_pwd:e};$.post(t,r,function(e){var t=parseInt(e.retcode,10),r=e.retmsg;0==t?location.reload():o.showError(t,r)})},urgeOrder:function(e,t){var r="/order/user_urge_order.json",a={order_id:e};$.post(r,a,function(e){var r=parseInt(e.retcode,10),a=e.retmsg,n=e.delivery_name||"";0==r?o.showMsg({retmsg:t.replace(/\{name\}/gi,n)}):o.showError(r,a)})},cancelOrder:function(e){$.post("/order/submit_cancel_order.json",e,function(e){var t=parseInt(e.retcode,10),r=e.retmsg;0==t?location.reload():o.showError(t,r)})},repealCancelOrder:function(e){var t=this,r="/order/repeal_cancel.json",a={order_id:e};$.get(r,a,function(e){0==e.retcode?window.location.reload():(t.hide(),o.showError(e.retcode,e.retmsg))})},showQrBox:function(t){var r=e("qr_box_tpl",t);o.show({title:"扫一扫，前往手机端",content:r,button:[]})},bindEvent:function(){var t=this,r=($("body"),$("#pager_bar")),f=$("#order_list_wrap");$(".js-state-tab").on("click",function(e){e.preventDefault();var a=$(this),o=$(".js-state-tab"),c=1;if(!u){switch(h=a.data("type"),o.removeClass(i),a.addClass(i),h){case"unapprove":n=window.G_UNAPPROVAL_TYPE;break;case"unconfirm":n=window.G_UNCONFIRM_TYPE;break;case"unevaluate":n=window.G_UNEVALUATE_TYPE;break;default:n=""}var f=l[h+"_"+c];f?(0==f.order_list.length?r.addClass(d):r.removeClass(d),t.renderOrderList({data:f,is_need_render_pagebar:1})):($("#order_list_wrap").html(s),r.html(""),p(c))}}),f.on("mouseover","#show_info",function(e){e.preventDefault();var r=$(this),a=r.find(".js-step-wrap"),o=a.attr("data-init"),n={order_id:a.data("order-id")};0!=o||u||t.queryOrderTrack(a,n)}),f.on("click",".js-pop-order-confirm",function(e){e.preventDefault(),c=$(this).data("order-id"),o.showIframe({width:640,height:293,url:"//mall.fenqile.com/user/verify_pay_pwd.html"})}),f.on("click",".js-btn-selfaudit",function(e){e.preventDefault();var t=$(this).data("order-id");o.showIframe({title:"确认个人信息",width:640,height:270,url:"//mall.fenqile.com/order/selfaudit/"+t+".html",button:[]})}),f.on("click",".js-upload-info",function(e){e.preventDefault();var r=$(this),a=r.data("order-id"),o=parseInt(r.data("is-merch-order"));if(o){var n={title:"扫一扫，即刻穿越到手机端",tip:"",url:location.protocol+"//merchpay.m.fenqile.com/user/user_upload/"+a+".html"};t.showQrBox(n)}else location.href="//mall.fenqile.com/pocket/upload_info/"+a+".html"}),f.on("click",".js-show-qingguan-btn",function(e){e.preventDefault();var r=$(this),a=r.data("order-id"),o={title:"电脑端暂不支持清关信息上传，扫描二维码可以在手机端上传",tip:"",url:location.protocol+"//trade.m.fenqile.com/user/upload_id_card.html?order_id="+a};t.showQrBox(o)}),f.on("click",".js-auth-method",function(e){e.preventDefault();var r=$(this),a=r.data("order-id"),o=parseInt(r.data("is-merch-order"));if(o){var n={title:"扫一扫，即刻穿越到手机端",tip:"",url:location.protocol+"//merchpay.m.fenqile.com/auth/auth_method/"+a+".html"};t.showQrBox(n)}else location.href="//mall.fenqile.com/user/auth_method/"+a+".html"}),f.on("click",".js-urge-order",function(e){e.preventDefault();var r=$(this);t.urgeOrder(r.data("order-id"),r.data("suc-text"))}),f.on("click",".js-cancel-order",function(e){e.preventDefault();var r=$(this),n=1==r.data("reason-required-flag"),i=r.data("confirm-text"),d=r.data("order-id"),l=r.data("ec-cancel-href"),c={order_id:d};n?a.loadFrame({url:l?l:"/order/cancel/"+d+".html",ready:function(e,t){var r=this;r.watchMethod({method:"dismiss_cancel",callback:function(e,t){t(),r.close()}})}}):i?o.showMsg({retmsg:i,icon:"i-warn",button:[{id:"ok",value:"确定",handler:function(){FQL.Stat.clickStat("GIVE_UP_CANCEL_GROUP_ORDER_"+d),t.cancelOrder(c)}},{id:"cancel",value:"取消",className:"btn-gray",handler:function(){FQL.Stat.clickStat("CANCEL_GROUP_ORDER_CONFIRM_"+d),this.hide()}}]}):t.cancelOrder(c)}),f.on("click",".js-add-comment",function(e){e.preventDefault();var t=$(this);a.loadFrame({url:"/comment/add/"+t.attr("data-order-id")+".html",ready:function(e,r){G_CUR_FRAME=this,G_CUR_FRAME.watchMethod({method:"comment_add",callback:function(e,r){r(),G_CUR_FRAME&&G_CUR_FRAME.close(),t.addClass(d),o.showMsg({retmsg:"评价提交成功",button:[{id:"ok",value:"确定",handler:function(){this.hide()}}]})}})}})}),f.on("click","#aftersale_process",function(e){var r=$(this);if(r.data("credit-card-pay")&&(e.preventDefault(),o.showMsg({retmsg:"退货周期内已收取的分期手续费银行不退，如有疑问请联系银行",icon:"i-warn",button:[{id:"ok",value:"确定",handler:function(){this.hide(),location.href=r.attr("href")}}]})),r.data("is-merch-order")){e.preventDefault();var a={title:"扫一扫，即刻穿越到手机端",url:location.protocol+r.data("url")};t.showQrBox(a)}}),f.on("click",".js-repeal-cancel",function(){var e=$(this).data("order-id");o.show({title:"撤销关单",width:520,height:300,content:$("#cancel_close_order_tpl").html(),button:[{id:"ok",value:"确定",className:"",display:!0,disabled:!1,handler:function(){FQL.Stat.clickStat("REPEAL_CANCEL_ORDER_CONFIRM"+e),t.repealCancelOrder(e),this.hide()}},{id:"cancel",value:"取消",className:"btn-gray",display:!0,disabled:!1,handler:function(){FQL.Stat.clickStat("REPEAL_CANCEL_ORDER_CANCEL"+e),this.hide()}}]})}),f.on("click",".js-pop-show-qr",function(e){e.preventDefault();var r=$(this),a=r.data("type"),o=r.data("order-id"),n={title:"扫一扫，即刻穿越到手机端",tip:"专享申请入口，售后无忧"},i=location.protocol+"//trade.m.fenqile.com/pop/aftersale_apply/"+o+".html";switch(a){case"cancel":i+="?action=cancel"}n.url=i,t.showQrBox(n)}),f.on("click",".js-go-to-pay",function(r){r.preventDefault();var a,n=$(this),i=n.data("order-id"),d=n.data("is-lehua"),l=n.data("to-pay-href"),c=n.data("is-merch-order"),s=n.data("is-stipend"),h=n.data("is-cardniu"),u=n.data("is-liepin"),p=n.data("is-vip"),f=n.data("is-pay-flag");if(1==c)return a={title:"扫一扫，即刻穿越到手机端",tip:"",url:location.protocol+"//merchpay.m.fenqile.com/trade/buy/edit/"+i+".html"},t.showQrBox(a),!1;switch(1){case d:a={name:"乐花",type:"LEHUA"};break;case s:a={name:"乐助学",type:"STIPEND"};break;case h:a={name:"卡牛",type:"CARDNIU"};break;case u:a={name:"猎聘",type:"LIEPIN"};break;case p:a={name:"会员",type:"VIP"};break;default:return l&&1==f?(a={title:"扫一扫，即刻穿越到手机端",tip:"",url:location.protocol+l},void t.showQrBox(a)):(location.href="//pay.fenqile.com/trade/buy/edit/"+i+".html",!1)}var _=e("app_tip_tpl",a);o.showMsg({retmsg:_,icon:"i-warn",button:[]})}),f.on("click",".js-check-detail",function(e){e.preventDefault();var r=$(this),a=r.data("order-id"),o=r.data("is-merch-order");if(1==o){var n={title:"扫一扫，即刻穿越到手机端",tip:"",url:location.protocol+"//merchpay.m.fenqile.com/order/detail/"+a+".html"};t.showQrBox(n)}else location.href="//order.fenqile.com/order/detail/"+a+".html"}),o.on("hide",function(){1==window.G_IS_REFRESH&&location.reload()}),$(".js-banner-close").on("click",function(e){e.preventDefault(),$(this).parent().hide()})},initPara:function(){p(1)},init:function(){this.initPara(),this.bindEvent()}};f.init()});