seajs.use(["~template@3","~box@1","~frame_host@1","~stat@1.x","~timer@1"],function(e,t,n,i,o){var r=1,a=window.G_PARENT_ORDER_ID?window.G_PARENT_ORDER_ID:window.G_ORDER_ID,l="fn-hide",s=null,_=" ",d="surplus-on";window.G_IS_REFRESH=0,window.G_BOX=new t,window.G_INVOICE_CALLBACK=function(){G_BOX.showMsg({retmsg:"发票申请成功",button:[{id:"ok",value:"确定",handler:function(){$("#apply_invoice").hide(),this.hide()}}]})},window.G_CLIPBOARD_CALLBACK=function(){G_BOX.showMsg({retmsg:"复制成功",button:[{id:"ok",value:"确定",handler:function(){this.hide()}}]})};var c={queryInitInfo:function(){var e=this,t="/order/get_init_info.json",n={order_info:G_ORDER_INFO,order_id:G_ROUTE_ORDER_ID,need_order_track:G_PARENT_ORDER_ID||G_IS_INSURANCE||G_IS_NEED_TO_CHECK_MSG?0:1};$.post(t,n,function(t){var n=parseInt(t.retcode,10),i=t.retmsg;0==n?e.renderInitInfo(t):G_BOX.showError(n,i)})},renderInitInfo:function(t){var n=t.init_info;n.order_id=window.G_ORDER_ID,$("#contract_invoice_wrap").html(t.contract_invoice_html),n.fe_ex_has_drawback_track_flag&&($("#refund_wrap").html(e("tpl_refund_wrap",{list:n.fe_ex_drawback_tracks_info})),$("#refund_track_tab").removeClass(l),n.fe_ex_drawback_tracks_info&&n.fe_ex_drawback_tracks_info.length>1&&($("#express_box").append(e("track_arrow_tpl",{ele_id:"refund_switch"})),$("#refund_switch").addClass(l))),!window.G_IS_SHOP_CART_ORDER&&window.G_IS_SHOW_GO_PAY&&n.fe_ex_is_lx_pay&&$("#btn_need_pay").removeClass(l),$("#btn_wrap").html(e("tpl_btn_wrap",n)),n.fe_ex_insurance_info&&n.fe_ex_insurance_info.insurance_url&&n.fe_ex_insurance_info.sku_name&&$("#product_name_wrap").append(e("tpl_insurance_info",n.fe_ex_insurance_info)),n.fe_ex_is_lx_pay&&n.fe_bill_info&&this.renderBillWrap(n.fe_bill_info),n.fe_track_info&&n.fe_track_info.length>0&&($("#order_track_tab").attr("data-init","1"),n.fe_track_info.length>0&&($("#express_box").removeClass(l),this.renderTrackInfo(n.fe_track_info))),$("#default_track_wrap").remove()},renderTrackInfo:function(t){var n=e("track_wrap_tpl",{track_info:t}),i=e("track_arrow_tpl",{ele_id:"track_switch"});$("#track_wrap").html(n),t.length>r&&$("#express_box").append(i)},renderBillWrap:function(t){var n,i,o,r,a=t.bill_info;a&&a.length>0&&(t.is_repay_finish?(o="//mall.fenqile.com/my/bill.html",n="查看账单"):(o="###",n="立即还款",i="repay_bill"),t.text=n,t.id_name=i,t.url=o,r=e("bill_link_tpl",t),$("#bill_link").html(r))},queryAppleIdOrderState:function(){var e="/order/query_apple_id_order_state.json",t={order_id:window.G_ORDER_ID};$.post(e,t,function(e){var t=parseInt(e.retcode,10),n=e.retmsg,o=e.result_rows,r=parseInt(o.show_alarm,10),a=parseInt(o.can_redirect,10);0==t?1==r&&1==a?G_BOX.showMsg({title:"免责申明",icon:"i-warn",retmsg:o.alarm,width:580,height:250,button:[{id:"cancel",value:"取消",className:"btn-gray btn-lg",handler:function(){i.clickStat("ADD_APPLE_ID_CANCEL_"+window.G_ORDER_ID),this.hide()}},{id:"ok",value:"我知道了",className:"btn-lg",handler:function(){i.clickStat("ADD_APPLE_ID_CONFIRM_"+window.G_ORDER_ID),this.hide(),1==a&&(location.href=o.url)}}]}):1==a?location.href=o.url:G_BOX.showMsg({title:"提示",icon:"i-warn",retmsg:"订单正在处理中，请检查您的订单是否已支付首付，稍后请再次尝试。",width:580,height:250,button:[{id:"ok",value:"确定",className:"btn-lg",handler:function(){this.hide()}}]}):G_BOX.showError(t,n)})},copyToClipboard:function(e,t){window.clipboardData&&window.clipboardData.setData?(window.clipboardData.setData("text",t),window.G_CLIPBOARD_CALLBACK()):document.execCommand("Copy")?(e.siblings("input").show().select(),document.execCommand("Copy"),window.G_CLIPBOARD_CALLBACK(),e.siblings("input").hide()):G_BOX.showMsg({title:"提示",icon:"i-warn",retmsg:"您的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。",width:580,height:250,button:[{id:"ok",value:"确定",className:"btn-lg",handler:function(){e.hide(),e.text(""),e.siblings("input").show().select()}}]})},cancelOrder:function(){var e={order_id:window.G_ORDER_ID};$.post("/order/submit_cancel_order.json",e,function(e){var t=parseInt(e.retcode,10),n=e.retmsg;0==t?location.reload():G_BOX.showError(t,n)})},setTimer:function(){var e=new o({showDay:!1,selector:"#pay_end_time"});e.start(),e.startMsec()},querySendSms:function(e){var t="/order/query_send_sms.json",n={send_type:8};$.post(t,n,function(t){var n=parseInt(t.retcode,10),i=t.retmsg;0==n?e&&e(!0):(G_BOX.showError(n,i),e&&e(!1))},"json",".js-g-module-sms-send-btn")},verifyFuluAndCouponSms:function(e){var t="/order/query_verify_fulu_and_coupon_sms.json",n=this,i={sms_code:e,send_type:8,order_id:G_ROUTE_ORDER_ID};$.post(t,i,function(e){var t=parseInt(e.retcode,10),i=e.retmsg;0==t?(n.renderFuluAndCouponDetail(e),s.hideAndDestroy()):G_BOX.showError(t,i)},"json",".js-g-module-sms-submit-btn")},renderFuluAndCouponDetail:function(t){if(t&&!$.isEmptyObject(t.virtual_info)){var n=t.virtual_info.fulu_info&&t.virtual_info.fulu_info.length>0?"fulu_info_tpl":"coupon_info_tpl",i=e(n,t.virtual_info);i&&($(".js-virtual-info").remove(),$(".js-virtual-info-box").prepend(i),$(".js-virtual-tips").removeClass(l))}},renderFuluAndCouponSms:function(e){var t=this;s?(s.show(),$(".js-g-mobile-sms-code-input").parent().before('<a class="js-modify-mobile" href="http://mall.m.fenqile.com/app/safe/modify_mobile.html">更换手机号</a>'),s.send()):seajs.use(["~sms@1"],function(n){s=new n({desc:"短信验证通过后可以查看卡密。验证码将发送至分期乐注册手机号。",mobile:e||_,sendHandler:function(e,n){t.querySendSms(n)},verifyHandler:function(e,n){t.verifyFuluAndCouponSms(n)}}),s.show(),$(".js-g-mobile-sms-code-input").parent().before('<a class="js-modify-mobile" href="http://mall.m.fenqile.com/app/safe/modify_mobile.html">更换手机号</a>'),s.send()})},bindEvent:function(){var t=this,o=$("body");window.G_IS_NEED_PAY&&t.setTimer(),$(".js-track-tab").on("click",function(e){e.preventDefault();var t=$(this),n=$(".js-track-tab"),i=t.data("type");n.removeClass("ui-tab-item-current"),t.addClass("ui-tab-item-current"),$(".js-switch").addClass(l),$(".js-express-wrap").addClass(l),$("#"+i+"_switch").removeClass(l),$("#"+i+"_wrap").removeClass(l)}),o.on("click",".js-switch",function(e){e.preventDefault();var t=$("#express_box"),n=$(".js-switch-name"),i="express-open";t.toggleClass(i),n.html(t.hasClass(i)?"收起详情":"展开详情")}),$("#bill_link").on("click","#repay_bill",function(e){e.preventDefault();var t=$(this).data("repay-id");G_BOX.showIframe({title:"还款",width:"700",height:"340",url:"//mall.fenqile.com/repay/confirm/"+t+".html",button:[]})}),o.on("click","#invoice_error",function(e){e.preventDefault(),G_BOX.showMsg({title:"提示",icon:"i-ok",retmsg:$("#invoice_error").data("error-msg"),retcode:"",width:580,height:250,button:[{id:"ok",value:"确定",className:"",display:!0,disabled:!1,handler:function(){this.hide()}}]})}),$("#modify_bank").on("click",function(e){e.preventDefault(),G_BOX.showIframe({width:600,height:311,url:"//mall.fenqile.com/user/modify_bankcard/"+window.G_ORDER_ID+".html"})}),$(".js-show-repay-list").on("click",function(e){e.preventDefault(),G_IS_CREDIT_CARD_PAY?G_BOX.showMsg({retmsg:"由于这笔订单通过信用卡支付，故其月供、服务费、分期数等信息，请以银行账单为准",icon:"i-warn",button:[{id:"ok",value:"确定",handler:function(){this.hide()}}]}):G_BOX.showIframe({title:"还款详情",width:652,height:400,url:"//mall.fenqile.com/repay/repay_list/"+a+".html?scene=order"})}),o.on("click","#apply_after_sale",function(e){if(G_IS_CREDIT_CARD_PAY){e.preventDefault();var t=$(this).attr("href");G_BOX.showMsg({retmsg:"退货周期内已收取的分期手续费银行不退，如有疑问请联系银行",icon:"i-warn",button:[{id:"ok",value:"确定",handler:function(){this.hide(),location.href=t}}]})}}),o.on("click","#apply_invoice",function(e){e.preventDefault(),G_BOX.showIframe({title:"选择发票类型",width:680,height:332,url:"/invoice/apply.html?sku_id="+window.G_SKU_ID+"&order_id="+window.G_ORDER_ID})}),$("#add_comment").on("click",function(e){e.preventDefault(),n.loadFrame({url:"/comment/add/"+window.G_ORDER_ID+".html",ready:function(){var e=this;e.watchMethod({method:"comment_add",callback:function(t,n){n(),e.close(),$("#add_comment").hide(),G_BOX.showMsg({retmsg:"评价提交成功",button:[{id:"ok",value:"确定",handler:function(){this.hide()}}]})}})}})}),$(".js-show-qrcode").on("click",function(t){t.preventDefault();var n={title:"该商品暂不支持电脑端支付，扫描二维码可使用手机支付。",tip:"扫描上方二维码进入手机端，登录后可支付",url:location.protocol+"//trade.m.fenqile.com/order/detail/"+window.G_ORDER_ID+".html"},i=e("qr_box_tpl",n);G_BOX.show({title:"前往手机端",content:i,width:640,height:300,button:[]})}),G_BOX.on("hide",function(){1==window.G_IS_REFRESH&&location.reload()}),seajs.use(["~tooltip@1"],function(e){$("body").find(".js-tooltip").each(function(){new e($(this))})}),$("#apple_id_recharge").on("click",function(){t.queryAppleIdOrderState()}),o.on("click",".clipboard",function(){var e=$(this);c.copyToClipboard(e.siblings("span"),e.siblings("span").text())}),$(".js-get-password").on("click",function(){t.renderFuluAndCouponSms()}),$("#apply_gift").on("click",function(t){t.preventDefault();var n={title:"扫描下方二维码，进入学生专享赠品领取通道",tip:"扫描上方二维码：开始申请赠品",url:location.protocol+"//item.m.fenqile.com/sale/apple.html"},i=e("qr_box_tpl",n);G_BOX.show({title:"赠品申请",content:i,width:640,height:300,button:[]})}),$(".js-cancel-order").on("click",function(e){e.preventDefault();var o=$(this),r=1==o.data("reason-required-flag"),a=o.data("confirm-text");r?n.loadFrame({url:"//trade.fenqile.com/order/cancel/"+window.G_ORDER_ID+".html",ready:function(){var e=this;e.watchMethod({method:"dismiss_cancel",callback:function(t,n){n(),e.close()}})}}):a?G_BOX.showMsg({retmsg:a,icon:"i-warn",button:[{id:"ok",value:"确定",handler:function(){i.clickStat("GIVE_UP_CANCEL_GROUP_ORDER_"+window.G_ORDER_ID),t.cancelOrder()}},{id:"cancel",value:"取消",className:"btn-gray",handler:function(){i.clickStat("CANCEL_GROUP_ORDER_CONFIRM_"+window.G_ORDER_ID),this.hide()}}]}):t.cancelOrder()}),$("#remark_drop").on("click",function(e){e.preventDefault();var t=$(this),n=$("#remark_drop_tips"),i=n.data("up-tips"),o=n.data("down-tips"),r=$(".js-hide-goods");t.hasClass(d)?(r.addClass(l),t.removeClass(d),n.html(o)):(r.removeClass(l),t.addClass(d),n.html(i))}),$("#fill_identity_info").on("click",function(){var t={title:"电脑端暂不支持清关信息上传，扫描二维码可以在手机端上传",tip:"使用分期乐APP扫描上方二维码",url:location.protocol+"//trade.m.fenqile.com/user/upload_id_card.html?order_id="+window.G_ORDER_ID},n=e("qr_box_tpl",t);G_BOX.show({title:"提示",content:n,width:640,height:300,button:[]})})},initPara:function(){this.queryInitInfo()},init:function(){this.initPara(),this.bindEvent()}};c.init()});
//# sourceMappingURL=//trade.fenqile.com/res/static/order/detail.js.map