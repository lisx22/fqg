seajs.use(["~pagelet@1","module/region_jd/region_jd","~timer@1","~box@1","~login@1","~combobox@1","~geolocation@1","~strtool@1","~template@3","~url@1","~storage@1","~behavior@1","~paging@1","~form@1","module/mouseover_slider/mouseover_slider","~lazyload@1","module/pic_viewer/pic_viewer","~slider@2"],function(e,t,o,i,a,n,s,r,_,l,d,u,c,m,f,p,v,h){var S=$("body"),G="fn-hide",g="on",k=new i,C=new u,b="btn-disabled",U="btn-pink",w="st-on",I=$("#btn_buy"),y=$("#btn_arrival_remind"),K=$("#remote_area_text"),T=$("#mark_merch"),O="ui-tab-item-current",R='<i class="i-keep i-no-keep"></i>取消收藏',j='<i class="i-keep"></i>收藏商品',E=0,D="i-d-buy",L="i-d-time",P="limit",B="fixed-top",q="js-disabled",x="li-quan-disabled",N="",A="active-limit",M="org-main",F=G_SKU.max_buy_num?G_SKU.max_buy_num:1,z=G_SKU.min_buy_num?G_SKU.min_buy_num:1,Y=G_SKU.sku_id,V=$("#buy_num").val()||1,X=1,H=0,Q=0,W=0,J=0,Z=0,et=0,tt="",ot="",it="",at="",nt="",st="",rt="",_t={},lt={},dt=1,ut=0,ct="开始预约",mt="开抢",ft=0,pt="已领取",vt="暂无数据",ht="已下架",St="该商品暂不支持单独购买",Gt="若商品在30天内到货，我们会通过短信和手机客户端消息通知您！",$t={cancel:0,mark:1},gt=!1,kt=0,Ct={have_received:2},bt=new o({selector:"#limit_sale_count_down"}),Ut=new o({selector:"#book_count_down"}),wt=null,It={arrivalForm:null,htmlDecode:function(e){return $("<div/>").html(e).text()},statReport:function(e){FQL.Stat.clickStat("ITEM.ITEM.INDEX."+e)},getSkuId:function(){var e="",t=this.getSkuKey();return G_SKU_LIST&&$.each(G_SKU_LIST,function(o,i){return t==i.sku_key?(e=i.sku_id,!1):void 0}),e},getSkuKey:function(){var e="";return $.each($(".js-sku-key"),function(){var t=$(this),o=$.trim(t.data("value"));t.hasClass(g)&&(e+=o)}),e},querySkuInfo:function(){if(Y=this.getSkuId(),!Y)return!1;var e=this,t="/item/query_sku_info.json",o={sku_id:Y,province_id:ot,city_id:it,area_id:at,direct_send:1,product_type:G_PRODUCT_TYPE,index_flag:dt};return $(".js-sku-key").addClass(q),0==ut&&e.skuPicAddLoading(),G_SKU_LIST&&_t[at]&&_t[at][Y]?(G_SKU=_t[at][Y],e.renderSku(),!1):void $.get(t,o,function(t){var o=t.retcode,i=t.retmsg;0==o?(dt++,_t[at]=_t[at]||{},_t[at][Y]=t.sku,G_SKU=t.sku,e.renderSku()):(k.showError(o,i),$(".js-sku-key").removeClass(q))})},checkIsProvinceRemote:function(e){var t={province_id:ot};$.get("/item/check_is_remote.json",t,function(t){var o=t.retcode,i=t.retmsg;0==t.retcode?t.result_rows.info?(e.addClass(G),K.html(e.html()+"，"+t.result_rows.info).removeClass(G)):(e.removeClass(G),K.addClass(G)):k.showError(o,i)},"json",".js-null")},queryInfobyArea:function(){if(!Y)return!1;var e="/item/query_info_by_area.json",t={sku_id:Y,province_id:ot,city_id:it,area_id:at,province_name:nt,city_name:st,area_name:rt};$("#jd_delivery").addClass(G),$.post(e,t,function(e){var t=e.retcode,o=e.retmsg;0==t?e.result_rows&&1==e.result_rows.jisuda_flag&&$("#jd_delivery").removeClass(G):k.showError(t,o)})},skuSoldOut:function(e){var t=e&&e.is_not_support_buy?1:0,o=t?St:ht;$(".js-sku-stock").addClass(G),$("#btn_buy_text").html(o),$(".js-addrress-tr").addClass(G),this.disableBuyBtn(),y.addClass(G),$("#coupon_area").removeClass(q),this.skuPicRemoveLoading(G_SKU.sku_pic_absolute_address)},skuPicAddLoading:function(){$("#img_lazy").removeClass(G),$("#preview_img").addClass(G)},skuPicRemoveLoading:function(e){$("#img_lazy").addClass(G),$("#preview_img").removeClass(G).attr("src",e)},renderSku:function(){var e=this;return $(".js-sku-key").removeClass(q),F=G_SKU.max_buy_num,z=G_SKU.min_buy_num,G_SKU.sku_num=parseInt(G_SKU.sku_num,10),e.renderDefaultInfo(),Y=e.getSkuId(),Y&&G_SKU?G_SKU.is_supported_buy_alone?(e.renderSkuBasicInfo(),e.renderSkuTitleTag(),e.renderSkuPic(),e.renderArriveTime(),e.resetBuyBtnStatus(),e.renderStock(),e.renderFavorite(),e.renderPrice(),e.renderFqList(),e.renderFirstPay(),e.renderSkuDetails(),e.renderServiceInfo(),e.renderGiftInfo(),e.renderWord(),e.renderLcode(),e.renderFreeInterestInfo(),e.renderFreeInterestTips(),e.renderQuantity(),e.queryRatio(),e.renderSrcInfo(),e.renderFavInfo(),e.renderStatusInfo(),e.loadCouponList(),e.renderLiveUrl(),wt||e.queryVipGuideInfo(),void(ut&&(e.queryInfobyArea(),ut=0))):(e.skuSoldOut({is_not_support_buy:1}),!1):(e.skuSoldOut(),!1)},renderSkuTitleTag:function(){var e=G_SKU.concert_extra_info,t=$("#concert_sell_status"),o=e&&e.sell_status?e.sell_status:0;o&&t.size()>0&&G_CONCERT_SELL_TIPS[o]&&t.html(G_CONCERT_SELL_TIPS[o]),G_SKU.is_import&&1==G_SKU.is_import&&$("#import_tag").removeClass(G),G_SKU.is_self_shop&&1==G_SKU.is_self_shop&&$("#self_shop_tag").removeClass(G)},renderStatusInfo:function(){G_SKU.fe_params.book_not_end?this.renderBookInfo():G_SKU.fe_params.is_promotion_active?this.renderPromotionInfo():G_IS_GROUP_GOOD&&0!=G_SKU.group_sale_state?this.renderGrouponInfo():G_SKU.is_limit>0&&this.renderLimitSaleInfo()},renderBookInfo:function(){var e=this;$(".js-addrress-tr").addClass(G),G_SKU.fe_params.wait_for_book?e.showTimeMsg(G_SKU.fe_params.book_start_time,ct):G_SKU.fe_params.has_booked?e.showTimeMsg(G_SKU.fe_params.limit_start_time,mt):e.showBookCountDown(G_SKU.fe_params.book_end_time)},renderGrouponInfo:function(){G_SKU.group_sale_state==G_GROUPON_OPEN?0!=G_SKU.sku_num&&this.showBookCountDown(G_SKU.sale_end_time):G_SKU.group_sale_state==G_GROUPON_WAIT&&this.showTimeMsg(G_SKU.fe_params.sale_start_time,mt)},renderPromotionInfo:function(){var e=this;G_SKU.active_info.type==G_DACU?$("#dacu_img").removeClass(G):G_SKU.fe_params.promotion_icon_txt&&($("#promotion_icon_wrapper").removeClass(G),$("#promotion_icon").html(G_SKU.fe_params.promotion_icon_txt)),G_SKU.fe_params.is_show_original_price&&($(".js-original-price").html(G_SKU.fe_params.amount),$(".js-original-price-wrapper").removeClass(G)),G_SKU.fe_params.is_limit_sale&&$("#limit_sale_img").removeClass(G),1==G_SKU.fe_params.is_show_promotion_timer&&e.showLimitSaleCountDown(G_SKU.active_info.end_time)},renderLimitSaleInfo:function(){var e=this;switch($("#limit_sale_img").removeClass(G),G_SKU.is_limit){case G_LIMIT_EFFECT:$("#comment_count").length>0&&$("#price_div").addClass(M),e.showLimitSaleCountDown(G_SKU.end_active);break;case G_LIMIT_LOCK:e.showTimeMsg(G_SKU.begin_active,mt)}},renderSrcInfo:function(){if(G_IS_POP_GOOD&&1==G_IS_DRIVING_OR_EDUCATION){var e=G_SKU.goods_source_name;$("#goods_name").text(e)}$("#goods_source").attr("src",G_SKU.goods_source_icon_url_pc)},renderFavInfo:function(){$("#btn_favorite").data("sku-id",Y)},renderDefaultInfo:function(){var e=$(".js-mon-pay");e.html(e.data("has-fq")),G_IS_VIRTUAL_GOOD||$(".js-addrress-tr").removeClass(G),this.stopTimer(),$(".js-time-wrapper").addClass(G),$("#promotion_icon_wrapper").addClass(G),$("#dacu_img").addClass(G),$(".js-original-price-wrapper").addClass(G),$("#limit_sale_img").addClass(G)},renderSkuBasicInfo:function(){$.each(G_SKU,function(e,t){var o=$("#"+e);"sku_id"===e?o&&o.val(t):"mon_pay"!==e&&o&&o.text(t)})},renderSkuPic:function(){this.skuPicRemoveLoading(G_SKU.sku_pic_absolute_address),$("#thumb_list img").eq(0).attr("src",G_SKU.sku_pic_absolute_address)},renderArriveTime:function(){G_SKU.fe_params&&G_SKU.fe_params.arrive_time&&$(".js-arrive-time").text(G_SKU.fe_params.arrive_time)},renderPrice:function(){var e=$(".js-price"),t=$("#price_div"),o=($("#reduce_icon"),$(".js-normal-price")),i=$("#expect_price"),a=$("#monthpay_info"),n=$(".js-mart-amount");e.removeClass(G),t.removeClass(G).removeClass(P).removeClass(A).removeClass(M),o.removeClass(G),i.addClass(G),a.removeClass(G),n.addClass(G),G_SKU.fe_params.book_not_end||G_IS_GROUP_GOOD&&0!=G_SKU.group_sale_state?t.addClass(P):(G_SKU.fe_params.is_limit_sale||G_SKU.fe_params.is_dacu&&$("#dacu_img").length>0||!G_SKU.fe_params.is_promotion_active&&G_SKU.is_limit>0)&&t.addClass(A),G_SKU.fe_params.book_not_end&&e.addClass(G),G_SKU.fe_params.is_show_price=parseInt(G_SKU.fe_params.is_show_price,10),G_SKU.fe_params.book_not_end&&!G_SKU.fe_params.is_show_price&&(o.addClass(G),i.removeClass(G),e.addClass(G),a.addClass(G)),1!=G_IS_DRIVING_OR_EDUCATION||G_SKU.fe_params.is_promotion_active||n.removeClass(G)},renderStock:function(){var e=$(".js-sku-stock"),t=$("#have_goods"),o=$(".js-festival-has-stock"),i=$("#no_goods");G_SKU.sku_num>0&&!G_IS_INSURANCE&&!G_IS_CONCERT_GOOD&&!G_SKU.fe_params.book_not_end&&(G_IS_VIRTUAL_GOOD||G_SKU.fe_params.is_promotion_active||G_SKU.is_limit>0)?e.removeClass(G):e.addClass(G),G_SKU.fe_params.book_not_end?(t.addClass(G),G_IS_FESTIVAL&&o.addClass(G),K.addClass(G),i.removeClass(G)):G_SKU.sku_num>0?(!G_IS_FESTIVAL&&this.checkIsProvinceRemote(t),o.removeClass(G),i.addClass(G)):(o.addClass(G),t.addClass(G),K.addClass(G),i.removeClass(G))},enableBuyBtn:function(){I.removeClass(b)},disableBuyBtn:function(){I.addClass(b),I.removeClass(U),$("#book_num_text").addClass(G),$("#btn_buy_icon").removeClass(D).removeClass(L)},resetBuyBtnStatus:function(){var e=this,t=$("#book_num_text"),o=$("#book_people_num"),i=G_BUY_BTN_TXT.normal,a=D;e.disableBuyBtn(),t.addClass(G),y.addClass(G),G_SKU.sku_num=parseInt(G_SKU.sku_num,10),G_SKU.fe_params.book_not_end?(a=L,i=G_SKU.fe_params.wait_for_book?G_BUY_BTN_TXT.book.wait_for_book:G_SKU.fe_params.has_booked?G_BUY_BTN_TXT.book.has_booked:G_SKU.fe_params.in_book?G_BUY_BTN_TXT.book.book_rightnow:G_BUY_BTN_TXT.book.book_buy_now,G_SKU.fe_params.in_book?(I.addClass(U),o.html(G_SKU.fe_params.book_total),t.removeClass(G),G_SKU.fe_params.has_booked||e.enableBuyBtn()):G_SKU.fe_params.in_book||G_SKU.fe_params.has_booked||e.enableBuyBtn()):G_SKU.fe_params.is_promotion_active?(e.renderArrivalRemindBtn(),i=G_BUY_BTN_TXT.promotion[G_SKU.active_info.active_status]):G_IS_GROUP_GOOD?(i=G_SKU.group_sale_state&&G_BUY_BTN_TXT.groupon[G_SKU.group_sale_state]?G_BUY_BTN_TXT.groupon[G_SKU.group_sale_state]:G_BUY_BTN_TXT.normal,G_SKU.group_sale_state==G_GROUPON_OPEN&&e.renderArrivalRemindBtn()):(i=G_SKU.is_limit>0?G_BUY_BTN_TXT.sale_limit[G_SKU.is_limit]:G_BUY_BTN_TXT.normal,G_SKU.is_limit<=G_LIMIT_EFFECT&&e.renderArrivalRemindBtn(),0==G_SKU.is_limit&&(a=D)),$("#btn_buy_icon").addClass(a),$("#btn_buy_text").html(i)},renderArrivalRemindBtn:function(){var e=G_SKU.sku_num>0&&G_SKU.sku_num>=G_SKU.min_buy_num?1:0;1==e?(this.enableBuyBtn(),N=L):G_IS_VIRTUAL_GOOD||1!=G_SKU.sku_sale_channel||y.removeClass(G)},renderRatio:function(){var e=this.getRatio();$(".js-quantity-btn").removeClass(q),$.each(e,function(e,t){var o=$("#"+e);"amount"!=e&&o&&o.text(t)}),0==et?$("#month_pay_icon").addClass(G):$("#month_pay_icon").removeClass(G)},renderFirstPay:function(){var e=G_SKU.fe_params.sku_fp_ratio;if(e){var t="",o=$("#fp_ratio"),i=o.data("tpl"),a=0;for(var n in e)a++,1==a&&$("#default_text").text(e[n].text),t+=i.replace(/{value}/,n).replace(/{text}/,e[n].text);o.html(t).combobox("rebuild")}},renderFqList:function(){var e=G_SKU.fq_list;if(e){for(var t="",o=$("#tpl_fq_list").html(),i="",a=0;a<e.length;a++)e[a]==G_SKU.fq_num&&(i=g),t+=0==a&&0==e[a]?o.replace(/{\$cls_name}/,i).replace(/{\$value}/,e[a]).replace(/{\$text}/,"不分期"):o.replace(/{\$cls_name}/,i).replace(/{\$value}/,e[a]).replace(/{\$text}/,e[a]+"个月");$("#fq_list_item").html(t),this.renderFeeDiscountInfo(G_SKU.fq_num)}},renderFeeDiscountInfo:function(e){G_SKU.fe_params.fee_discount_list&&G_SKU.fe_params.fee_discount_list[e]&&G_SKU.fe_params.fee_discount_list[e].fee_discount_rate?($("#fee_discount_wrap").removeClass(G),$("#fee_discount_desc").html(G_SKU.fe_params.fee_discount_list[e].fee_discount_rate)):($("#fee_discount_wrap").addClass(G),$("#fee_discount_desc").html(""))},renderQuantity:function(){if(G_IS_GROUP_GOOD||G_IS_CONCERT_GOOD||G_IS_ROUTE_GOOD){var e=$("#show_quantity"),t=$("#num_add"),o=$("#num_minus"),i=$("#buy_num");if(e.length>0){var a=parseInt(i.val(),10),n=F;G_SKU.sku_num<n&&G_SKU.sku_num>0&&(n=G_SKU.sku_num),n>0&&a>n&&(i.val(n),V=n),t.removeClass(b),o.removeClass(b),G_SKU.sku_num>0&&G_SKU.sku_num>=z?e.removeClass(G):e.addClass(G)}}},renderSkuDetails:function(){if("groupon"==G_PRODUCT_TYPE){var e=["groupon_contain","buy_must_known","warming_remind"],t=["group_book_tip","group_book_phone","ticket_valid_time","group_invoice_info"];$.each(t,function(e,t){var o=G_SKU[t];o&&$("#"+t).html(o)})}else if("normal"==G_PRODUCT_TYPE)var e=["sku_detail","packing_list","sale_protection","category_aftersale"];("groupon"==G_PRODUCT_TYPE||"normal"==G_PRODUCT_TYPE)&&($.each(e,function(e,t){$("#"+t).html("")}),$.each(e,function(e,t){var o=G_SKU.fe_params.sku_detail_info[t];o=$.trim(o),"sale_protection"==t||"category_aftersale"==t?($("#"+t).removeClass(G),o||($("#"+t).addClass(G),o="")):o=o?o:vt,$("#"+t).html(o)}))},renderWord:function(){var e,t,o=$("#product_desc"),i=$("#product_link_text"),a=$("#product_link"),n=G_SKU.active_subtitle_info;n.brand_desc&&n.link_pc?(e=n.brand_desc,t=n.link_pc):(e=G_LINK_SETS.link_text,t=G_LINK_SETS.site_pc_link),n.brand_desc&&n.link_pc||G_LINK_SETS.is_show_link_text&&G_LINK_SETS.site_pc_link&&G_LINK_SETS.link_text?(i.html(e),a.attr("href",t).removeClass(G)):(i.html(""),a.addClass(G)),o.text(n.subtitle?n.subtitle+G_PRODUCT_DESC:G_PRODUCT_DESC)},renderGiftInfo:function(){var e=$("#gift_area");if(0==G_SKU.gift_list.length)return void e.html("");var t=_("tpl_gift_list",{gift_icon_list:G_SKU.fe_params.gift_icon_list,gift_list:G_SKU.gift_list});e.html(t)},renderCouponInfo:function(e){var t=$("#coupon_area");if(t.removeClass(q),ft=d.getItem("show_coupon_popup"),d.removeItem("show_coupon_popup"),e&&e.length>0){var o=_("tpl_coupon_area",{coupon_list:e}),i=_("tpl_coupon_popup",{coupon_list:e});t.html(o),$("#coupon_box_content").html(i),ft&&W&&this.showCouponBox()}else t.html(""),$("#coupon_box_content").html("")},loadCouponList:function(){var e=this,t={sku_id:Y,is_limit:G_SKU.is_limit,is_promotion:G_SKU.active_info&&2==G_SKU.active_info.active_status?1:0};return lt[Y]?void e.renderCouponInfo(lt[Y]):void $.post("/item/coupon_info.json",t,function(t){0==t.retcode?(lt[Y]=t.coupon_list,e.renderCouponInfo(lt[Y])):k.showError(t.retcode,t.retmsg)},"json",".js-null")},queryVipGuideInfo:function(){$.post("/item/query_vip_guide_info.json",{},function(e){0==e.retcode?wt=e.result_rows:k.showError(e.retcode,e.retmsg)},"json",".js-null")},renderFavorite:function(){var e=$("#btn_favorite");G_SKU.is_favorite?(e.html(R),E=1):(e.html(j),E=0)},renderLcode:function(){var e=$("#lcode_node");e.addClass(G),G_SKU.lcode_flag&&G_SKU.lcode_url&&(e.removeClass(G),$("#lcode_link").attr("href",G_SKU.lcode_url))},renderFreeInterestInfo:function(){var e=$("#new_free_interest_icon");e.addClass(G),G_SKU.is_digit_free_fee_flag&&e.removeClass(G)},renderFreeInterestTips:function(){G_SKU.fe_params.is_free_interest?$(".js-free-interest-tips").removeClass(G):$(".js-free-interest-tips").addClass(G)},renderSeatPic:function(){var e=this,t=$("#view_pic");$("#pic_box").removeClass(G),e.wrapCenter(t)},wrapCenter:function(e){var t=$(window),o=t.width(),i=t.height(),a=e.width(),n=e.height(),s=(o-a)/2,r=(i-n)/2,_=e[0].style;_.left=parseInt(s)+"px",_.top=parseInt(r)+"px"},queryAreaInfo:function(){var e=this;$.post("/item/query_area_info.json",{},function(t){{var o=t.retcode;t.retmsg}0==o&&($("#region").data("province-id",t.area_info.user_province_id).data("city-id",t.area_info.user_city_id).data("area-id",t.area_info.user_area_id).data("province-name",t.area_info.user_province_name).data("city-name",t.area_info.user_city_name).data("area-name",t.area_info.user_area_name),Q=t.have_filled_school_info,W=t.is_login,tt=t.mask_mobile,e.getLocationParam(),e.bindLocationEvents(),e.renderLiveUrl(G_SKU.sku_id))})},renderServiceInfo:function(){var e=r.substitute($("#tpl_sku_service_list").html(),G_SKU.fe_params.sku_service_flag);$("#sku_service_list").html(e),1==G_SKU.fe_params.jisuda_flag?$("#jd_delivery").removeClass(G):$("#jd_delivery").addClass(G)},queryRatio:function(){J=parseFloat(G_SKU.amount*V+H),J!=parseInt(J)&&(J=J.toFixed(2));var e=this,t="/item/query_sku_ratio.json",o={amount:J,sku:G_SKU};return $(".js-quantity-btn").addClass(q),!G_IS_CONCERT_GOOD&&G_RATIO_LIST[Y]&&G_RATIO_LIST[Y][V]?(e.renderRatio(),!1):void $.post(t,o,function(t){var o=t.retcode,i=t.retmsg;0==o?(G_RATIO_LIST[Y]=G_RATIO_LIST[Y]||{},G_RATIO_LIST[Y][V]=t.result_rows,e.renderRatio()):k.showError(o,i)})},showBookCountDown:function(e){if(this.stopTimer(),e){var t=/(\d{4})-(\d{2})-(\d{2})[ ](\d{2}):(\d{2}):(\d{2})/.exec(e),o=t[1]+"/"+t[2]+"/"+t[3]+" "+t[4]+":"+t[5]+":"+t[6],i=$("#tpl_book_count_down").html(),a=$("#book_time_wrapper"),n=$("#book_count_down");n.data("end",o).html(i),this.startBookTimer(),a.removeClass(G)}},showLimitSaleCountDown:function(e){if(this.stopTimer(),e){var t=/(\d{4})-(\d{2})-(\d{2})[ ](\d{2}):(\d{2}):(\d{2})/.exec(e),o=t[1]+"/"+t[2]+"/"+t[3]+" "+t[4]+":"+t[5]+":"+t[6],i=$("#tpl_limit_sale_count_down").html(),a=$("#limit_sale_time_wrapper"),n=$("#limit_sale_count_down");n.data("end",o).html(i),this.startLimitSaleTimer(),a.removeClass(G)}},showTimeMsg:function(e,t){var e=/\d{4}-(\d{2})-(\d{2})[ ](\d{2}):(\d{2})/.exec(e),o=$("#book_count_down"),i=$("#book_time_wrapper"),a=r.substitute($("#tpl_time_msg").html(),{mon:e[1],day:e[2],hour:e[3],min:e[4],text:t});o.html(a),i.removeClass(G)},getFpRatio:function(){return $("#fp_ratio").val()},getFqNum:function(){return $(".js-fq-item").filter("."+g).data("value")},getRatioKey:function(){Z=this.getFpRatio(),et=this.getFqNum();var e=[J,Z,et];return e.join("_")},getRatio:function(){var e={},t=G_RATIO_LIST[Y]&&G_RATIO_LIST[Y][V]?G_RATIO_LIST[Y][V]:"",o=this.getRatioKey();return t&&$.each(t,function(t,i){return o==t?(e=i,!1):void 0}),e},getConfirmUri:function(){var e=this,t=["//pay.fenqile.com/trade/buy",e.getFpRatio(),e.getFqNum(),V,Y];if(G_SKU.gift_qualify_type&&2==G_SKU.gift_qualify_type||G_SKU.gift_sku.length>0)return e.giftMask(),!1;if(G_IS_GROUP_GOOD||G_IS_CONCERT_GOOD||G_IS_ROUTE_GOOD){var o="/item/get_sale_index.json",i={sku_id:Y,price:G_SKU.fe_params.amount,quantity:$("#buy_num").val()};G_IS_CONCERT_GOOD&&(i.delivery_type=X),$.post(o,i,function(e){var o=e.retcode,i=e.retmsg;0==o?e.result_rows.sale_index&&(t.splice(-1,0,e.result_rows.sale_index),window.location.href=t.join("/")+".html"):k.showError(o,i)})}else window.location.href=t.join("/")+".html"},startBookTimer:function(){Ut._timer||Ut.start()},startLimitSaleTimer:function(){bt._timer||bt.start(),bt._msecTimer||bt.startMsec()},stopTimer:function(){bt._timer&&bt.stop(),Ut._timer&&Ut.stop()},showMonthPayIframe:function(){var e=[(100*J).toFixed(0),Z,et,Y];k.showIframe({title:"还款详情",width:650,height:430,url:"//mall.fenqile.com/repay/repay_list/"+e.join("/")+".html"})},showArrivalRemindIframe:function(){k.show({title:"到货提醒",content:$("#tpl_arrival_remind").html(),width:640,button:[]}),this.refreshImgCode(),this.arrivalForm=new m("#arrival_form")},showCouponBox:function(){k.show({title:"优惠券",width:495,height:500,content:$("#coupon_box_content").html(),button:[]})},getCoupon:function(e){var t=this,o=$(".js-coupon-li"),i="/item/get_coupon.json",a={tps_key:e};o.addClass(q),$.post(i,a,function(i){var a=i.retcode,n=i.retmsg;switch(a){case 0:case 38001014:$(".js-coupon-"+e).addClass(x),$(".js-disabled-"+e).html(pt),0==a?(t.statReport("COUPON_"+e),$.each(lt[Y],function(t,o){o.tps_key==e&&(lt[Y][t].receive_status=Ct.have_received)})):k.showError(a,n);break;case 37020430:wt&&wt.need_guide&&k.show({title:"提示",content:_("tpl_guide_lehei",wt),width:640,button:[]});break;default:k.showError(a,n)}o.removeClass(q)})},bindLocationEvents:function(){var e=this;$("#region_name").html(nt+st+rt),e.querySkuInfo(),t.init({id:"#region",province:nt,province_id:ot,city:st,city_id:it,area:rt,area_id:at,handler:function(t){var o=t.province+t.city+t.area;$("#region").data("province-id",t.province_id).data("city-id",t.city_id).data("area-id",t.area_id).data("province-name",t.province).data("city-name",t.city).data("area-name",t.area),it=t.city_id,$("#region_name").text(o),ut=1,e.getLocationParam(),e.querySkuInfo()}})},getLocationParam:function(){var e=$("#region");ot=e.data("province-id"),it=e.data("city-id"),at=e.data("area-id"),nt=e.data("province-name"),st=e.data("city-name"),rt=e.data("area-name")},submitDrivingPhone:function(){var e="/item/submit_driving_phone.json",t=this.getMobile($("#input_mobile").val()),o={sku_id:Y,product_id:G_PRODUCT_ID,is_pop_good:G_IS_POP_GOOD,advice_content:t};$.post(e,o,function(e){var t=e.retcode,o=e.retmsg;0==t?($("#driving_input_mobile").addClass(G),$("#driving_submit_success").removeClass(G)):k.showError(t,o)},"json","#submit_mobile")},submitArrivalRemind:function(e,t){var o=this,i="/item/submit_arrival_remind.json",a=this.getMobile(e),n={sku_id:Y,mobile:a},s=!1;t&&(n.img_code=t,s=!0),$.post(i,n,function(e){var t=e.retcode,i=e.retmsg;0==t?(s&&k.hide(),k.showMsg({retmsg:Gt})):s?($(".js-arrival-error-tips").text("["+t+"]"+i).removeClass(G),o.refreshImgCode()):k.showError(t,i)},"json","#btn_arrival_confirm")},getMobile:function(e){return e&&e==tt?"#":e},refreshImgCode:function(){var e=$("#verify_img");e.attr("src",e.attr("data-src")+"?v"+Math.random()),$("#mobile_imgcode").val("")},bindEvent:function(){var e=this,t=".js-comment-list",o=".js-consult-list",i=".js-right-ads",n=".js-similar-rankings",s=".js-recommend-history",r=null;$("#pual_detail").on("click",function(){var t=$("#qualification_container");e.bindLazyload("#qualification_container"),$("#qualification_wrap").removeClass(G),0==kt&&(new h({container:t,bannerHeight:400,autoStart:!1}),kt=1,t.trigger("scroll"))}),$("#close_qualification_wrap").on("click",function(){$("#qualification_wrap").addClass(G)}),S.on("click",".js-close-arrival-popup",function(){k.hide()}),S.on("click","#verify_img",function(t){t.preventDefault(),e.refreshImgCode()}),$("#consult_icon").on("click",function(t){1!=W?(t.preventDefault(),a.show()):e.statReport("CONTACT_CUSTOMER_SERVICE_"+Y)}),$(".js-sku-key").on("click",function(){var t=$(this);return t.hasClass(q)?!1:(t.siblings().removeClass(g),t.addClass(g),ft=0,$("#coupon_area").addClass(q),(Y=e.getSkuId())?void e.querySkuInfo():(e.skuSoldOut(),!1))}),$("#fp_ratio").on("change",function(){e.renderRatio()}),$("#fq_list_item").on("click",".js-fq-item",function(){var t=$(this),o=t.data("value"),i=$(".js-mon-pay");return t.addClass(g).siblings().removeClass(g),i.html(0==o?i.data("no-fq"):i.data("has-fq")),e.renderFeeDiscountInfo(o),e.renderRatio(),!1}),k.on("hide",function(){1==window.G_IS_REFRESH&&location.reload()}),$("#comment_count").on("click",function(){var t=0,o=$("#product_comment"),i=$("#tab_comment");t=G_IS_VIRTUAL_GOOD&&!G_IS_ROUTE_GOOD?i.offset().top-20:$(".js-product-detail").offset().top-20,scrollTo(0,t),o.addClass(O).siblings().removeClass(O),$(".js-tab-body").addClass(G),i.removeClass(G),e.statReport("BTN_TOP_COMMENT"+Y)}),$("#shipping").on("change",function(t){t.preventDefault();var o=parseInt($(this).val(),10),i=$(this.options[this.selectedIndex]);X=o,H=i.data("charge"),$(".js-shipping-way").addClass(G),$("#shipping_way_"+o).removeClass(G),e.queryRatio()});var _=$("#show_quantity");if(_.length>0){var l=$("#buy_num"),u=$("#num_add"),c=$("#num_minus");u.on("click",function(){if($(this).hasClass(b)||$(this).hasClass(q))return!1;c.hasClass(b)&&c.removeClass(b);var t=F;G_SKU.sku_num<F&&(t=G_SKU.sku_num),t>V&&(V++,l.val(V),e.queryRatio()),V==t&&u.addClass(b)}),c.on("click",function(){return $(this).hasClass(b)||$(this).hasClass(q)?!1:(u.hasClass(b)&&u.removeClass(b),V>z&&(V--,l.val(V),e.queryRatio()),void(V==z&&c.addClass(b)))})}$("#month_pay_icon").on("click",function(){Y&&e.showMonthPayIframe()}),y.on("click",function(){W?(e.statReport("BTN_ARRIVAL_REMIND_"+Y),tt?e.submitArrivalRemind(tt):e.showArrivalRemindIframe()):a.show()}),$("#btn_telephone_consult").on("click",function(){k.show({title:"电话咨询",content:$("#consult_phone_popup").html(),width:640,button:[]}),$("#input_mobile").val(tt),r=new m("#driving_form")}),S.on("click","#submit_mobile",function(){(""!=tt&&$("#input_mobile").val()==tt||r.validate())&&e.submitDrivingPhone()}),S.on("click","#btn_arrival_confirm",function(){var t=$("#arrival_input_mobile").val(),o=$("#mobile_imgcode").val();e.arrivalForm.validate()&&(o?e.submitArrivalRemind(t,o):$(".js-arrival-error-tips").text("请输入验证码").removeClass(G))}),S.on("click","#promotion_arrow",function(){$(this).toggleClass(w),$(".js-all-promotion-list").toggleClass(G)}),S.on("click","#mark_merch",function(){var t=parseInt($(this).data("isMark"));t||(W?e.markFavoriteShop($t.mark):a.show())}),S.on("click","#enter_merch",function(){e.enterShop()}),I.on("click",function(t){return t.preventDefault(),$(this).hasClass(b)?!1:G_SKU.fe_params.is_new_only&&!W?void a.show():G_SKU.fe_params.buy_not_end?(e.statReport("BTN_BOOK_"+Y),void k.show({title:"提示",content:$("#tpl_guide_book").html(),width:640,button:[]})):G_IS_POP?void e.guideMask():void(W?$.post("/item/is_gray_user.json",function(t){var o=t.retcode;0==o&&(t.is_gary_user?e.guideMask():(e.getConfirmUri(),e.statReport("BTN_BUY_"+Y)))}):a.show())}),$("#seat_pic").on("click",function(){e.renderSeatPic()}),$(".js-shield-close").on("click",function(){$("#pic_box").addClass(G)}),S.on("click",".js-coupon-icon",function(){return $(this).hasClass(q)?!1:(e.statReport("ICON_COUPON_"+(Y||e.getSkuKey())),void e.showCouponBox())}),S.on("click",".js-coupon-li",function(){var t=$(this),o=t.data("key");if(t.hasClass(x)||t.hasClass(q))return!1;if(W)e.getCoupon(o);else{var i=window.parent.location.href.replace(/\/\w+.html/,"/"+Y+".html");k.hide(),a.show({callback:function(){window.location.href=i,d.setItem("show_coupon_popup",1)}})}}),$("#btn_favorite").on("click",function(){return Y?void(W?1==E?e.deleteFavorite():e.addFavorite():a.show()):(k.showError("",ht),!1)}),$(".js-sku-tabs").on("click",function(){var t=$(this),o=t.data("target"),i=t.data("stat-name");t.addClass(O).siblings().removeClass(O),$(".js-tab-body").addClass(G),"tab_comment"!=o&&$("#"+o).removeClass(G),S.trigger("scroll"),e.statReport(i+Y)}),$("#bd_map_wrap").on("click",function(){k.showIframe({title:"商家地图",width:1e3,height:600,url:"/item/shop_position.html?sku_id="+Y})}),e.bindDetailTabs(),$(".js-adress").on("click",function(){e.statReport("BTN_ADDRESS_"+Y)}),$(t).on("pagelet-lazyload-onload",function(){e.resetSize(t),e.queryComment()}),$(o).on("pagelet-lazyload-onload",function(){e.resetSize(o),e.queryAdvice(),e.bindAdviceEvent()}),$(i).on("pagelet-lazyload-onload",function(){e.resetSize(i),e.bindLazyload(i)}),$(n).on("pagelet-lazyload-onload",function(){e.resetSize(n),e.bindLazyload(n)}),$(s).on("pagelet-lazyload-onload",function(){e.resetSize(s),e.bindLazyload(s)})},resetSize:function(e){$(e).css("height","auto")},bindLazyload:function(e){$(e).find("[data-original]").lazyload({effect:"fadeIn"})},bindDetailTabs:function(){var e=$("#detail_ul");if(e.length>0){var t=$(window),o=e&&e.offset()?e.offset().top:2500;t.scroll(function(){var i=t.scrollTop();i>o?e.addClass(B):e.removeClass(B)})}},bindCommentEvent:function(){$.each($(".js-pic-li"),function(e,t){new v({container:$(t).data("cls-name"),bigPhotoHtml:$("#tpl_big_img").html()})})},bindAdviceEvent:function(){var e=this,t=null;$(".js-advice").on("click",function(){W?(k.show({title:"商品咨询",width:1e3,button:[],content:$("#tpl_advice_wrap").html()}),t=new m("#advice_form"),e.statReport("BTN_CONSULT_"+Y)):a.show(),S.on("input","#input_question",function(){$("#advice_input_num").html($("#input_question").val().length)})}),S.on("click","#submit_advice",function(o){o.preventDefault(),t.validate()&&e.submitAdvice()})},submitAdvice:function(){var e={sku_id:Y,question:$("#input_question").val()},t=this;t.statReport("LINK_ADVICE_"+Y),$.post("item/submit_advice.json",e,function(e){var o=e.retcode,i=e.retmsg;if(0==o){k.hide();try{C.triggerBehaviorDataUpload({is_success:1,sku_id:Y})}catch(a){}t.showAdviceResult(),t.queryAdvice()}else k.showError(o,i),C.triggerBehaviorDataUpload({is_success:0,sku_id:Y})},"json","#submit_advice")},showAdviceResult:function(){k.show({title:"商品咨询",width:680,button:[],content:$("#tpl_box_advice_result").html()}),$("#btn_close_advice_result").on("click",function(){k.hide()})},queryAdvice:function(e){var t=this,o={product_id:G_PRODUCT_ID,page:e||1};$.get("/item/query_product_advice.json",o,function(o){var i=o.retcode,a=o.retmsg;if(0==i){W=o.is_login;var n=new c({page:e,totalPage:o.total_page,totalNum:o.total_num,showWhich:!1,isAjax:!0,onClick:function(e){t.queryAdvice(e)}});n.render("#advice_page");var s=_("tpl_advice",{list:o.result_rows});$("#advice_list").html(s)}else k.showError(i,a)})},setMerchMark:function(){T.data("isMark",1).text("已收藏")},queryShopDetail:function(){var e=this,t={merch_id:G_MERCH_ID};$.post("/item/get_merch_detail.json",t,function(t){var o=t.retcode,i=t.retmsg;0==o?1==t.result_rows[0].marked_self&&e.setMerchMark():k.showError(o,i)})},markFavoriteShop:function(e){var t=this,o="/favorite/mark_shop.json",i={merch_id:G_MERCH_ID,mark:e};gt||(gt=!0,$.post(o,i,function(o){var i=o.retcode,a=o.retmsg;0==i?e==$t.mark&&t.setMerchMark():k.showError(i,a),gt=!1},"json",".js-null"))},enterShop:function(){k.show({title:"提示",content:$("#tpl_h5_merch_code").html(),width:640,button:[]})},giftMask:function(){k.show({title:"提示",content:$("#tpl_gift_mask").html(),width:640,button:[]})},bookMask:function(){var e={actionType:"2",hottag:"BOOK_QRCODE_SHOW"};FQL.Stat.clickStatEc(e),k.show({title:"提示",content:$("#tpl_guide_book").html(),width:640,button:[]})},guideMask:function(){var e={actionType:"2",hottag:"QRCODE_SHOW"};FQL.Stat.clickStatEc(e),k.show({title:"提示",content:$("#tpl_guide_mask").html(),width:640,button:[]})},addFavorite:function(){var e=this,t={sku_id:Y};$.post("/favorite/add.json",t,function(t){var o=t.retcode,i=t.retmsg;0==o?($("#btn_favorite").html(R),e.statReport("BTN_FAV_"+Y),E=1):k.showError(o,i)})},deleteFavorite:function(){var e={sku_id:Y};$.post("/favorite/del.json",e,function(e){var t=e.retcode,o=e.retmsg;0==t?($("#btn_favorite").html(j),E=0):k.showError(t,o)})},queryComment:function(e){var t=this,o={product_id:G_PRODUCT_ID,page:e||1};$.get("/item/query_product_comment.json",o,function(o){var i=o.retcode,a=o.retmsg;if(0==i){var n=new c({page:e,totalPage:o.total_page,totalNum:o.total_num,showWhich:!1,isAjax:!0,isHideLastPage:!0,onClick:function(e){t.queryComment(e)}});n.render("#comment_page");var s=_("tpl_comment",{list:o.comment_list});$("#comment_list").html(s),o.comment_list&&t.bindCommentEvent()}else k.showError(i,a)})},renderLiveUrl:function(){var e=G_SKU.fe_params.live800_url?this.htmlDecode(G_SKU.fe_params.live800_url):"javascript:;";$("#consult_icon").attr("href",e)},initConcert:function(){var e=$("#shipping").val(),t=$("#shipping_way_"+e);H=t.data("charge"),X=e,$(".js-shipping-way").addClass(G),t.removeClass(G)},initMap:function(){var e=new s;e.showMap({wrapper:"bd_map_wrap",centerCoords:{longitude:G_SKU.longitude,latitude:G_SKU.latitude}}),e.setMark()},initParams:function(){Y=G_SKU.sku_id,new f({listNode:"#thumb_list",preNode:"#prev_thumb",nextNode:"#next_thumb",showImgWrap:"#preview_img"}),G_IS_CONCERT_GOOD&&this.initConcert(),(G_IS_GROUP_GOOD||G_IS_CONCERT_GOOD)&&this.initMap(),this.bindLazyload("#tab_detail")},sendSpeed:function(){seajs.use(["~speed@1"],function(e){new e({domainId:12,pageId:1,timePoint:G_SPEED_POINT_TIME})})},bindError:function(){var e=FQL.ErrorLogger.getLogger("item_index");e.bindError("911420001")},init:function(){G_SPEED_POINT_TIME.LOGIC={ID:5,DATA:[G_PAGE_LOAD_TIME,(new Date).getTime()]},this.bindError(),this.initParams(),this.bindEvent(),this.queryAreaInfo(),G_MERCH_ID&&"0"!=G_MERCH_ID&&this.queryShopDetail(),this.sendSpeed()}};It.init()});
//# sourceMappingURL=//item.fenqile.com/res/static/item/index.js.map