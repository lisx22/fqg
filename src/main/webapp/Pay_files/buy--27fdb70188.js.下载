seajs.use(["~box@1","~combobox@1","~format@1","~template@3","~url@1","~frame_host@1","~form@1","//cres1.fenqile.cn/pay/static/auth/component/process_control--41e1b446d3.js","~behavior@1"],function(e,t,n,i,s,o,_,a,r){var d="fn-hide",c="form-error",u="pay-li-on",l="on",w=FQL.box,f=window.G_PAY_AMOUNT,m=0,p=0,h=0,v=null,I={},E=0,g=null,G="",y="",O=null,C=[],D=[],S="",b=[],A=!1,k=window.G_IS_SHOW_POCKET_FEE_TIP,R={},T={},F={},N={title:"扫码穿越到手机端下单",tip:"",url:"http://cash.m.fenqile.com/cash/order.html"},L=new r,j={isCheckActivate:!1,isCheckAbleOrder:!1,isCheckOrderScene:!1,isCreateOrder:!1,isSubmitOrder:!1,isQueryUserAuth:!1,processCheck:function(){return this.isCheckActivate?this.isCheckAbleOrder?this.isCreateOrder||window.G_ORDER_ID?void a.processCheck({order_id:window.G_ORDER_ID,amount:window.G_PAY_AMOUNT},"frame_host"):void this.createOrder():void this.queryIsAbleOrder():void this.checkActivate()},getCurFee:function(){return I[window.G_EXP_GOLD+"_"+m+"_"+f+"_"+window.G_FP_RATIO+"_"+window.G_FQ_NUM]},checkIsNeedQueryFee:function(){$.isEmptyObject(this.getCurFee())?this.queryFeeList():this.renderFee()},queryIsLogin:function(e){var t="/auth/query_is_login.json";$.get(t,{},function(t){var n=parseInt(t.retcode,10);0==n&&(window.G_IS_LOGIN=t.is_login,$.isFunction(e)&&window.G_IS_LOGIN&&e())},"json","#btn_submit")},checkActivate:function(){var e=this;$.get("/auth/query_is_activate.json",{},function(t){var n=parseInt(t.retcode,10),i=t.retmsg,s=parseInt(t.pocket_status);0==n?0==s?w.showMsg({title:"30秒激活乐卡",icon:"i-warn",retmsg:"您尚未激活乐卡，完善个人信息，轻松获取最高万元信用消费额度。",button:[{id:"cancel",value:"稍后再说",handler:function(){e.hideLoadingMask(),this.hide()}},{id:"ok",value:"立即激活",handler:function(){this.hide(),e.isCheckActivate=!0,e.processCheck()}}]}):(e.isCheckActivate=!0,e.processCheck()):w.showError(n,i)},"json","#btn_submit")},queryFeeList:function(e){var t="/trade/query_fee_list.json",n={sku_id:window.G_SKU_ID,amount:f,fq_num:window.G_FQ_NUM,fp_ratio:window.G_FP_RATIO,order_type:window.G_ORDER_TYPE,sale_index:window.G_SALE_INDEX,order_id:window.G_ORDER_ID,experience_gold:window.G_EXP_GOLD,discount_amount:m,discount_type:h,need_repay_list_flag:e||0},i=this;this.hasPocketDiscount()&&(n.fee_discount_list=R);var s=window.G_EXP_GOLD,o=m;$.post(t,n,function(t){var n=parseInt(t.retcode,10),_=t.retmsg,a=t.pocket_event_info,r=!$.isEmptyObject(a);0==n?e?i.renderRepayListWrap(t):(G=t.fee_category_id,y=t.fee_default_id,$.each(t.sku_ratio,function(e,t){I[s+"_"+o+"_"+e]=t}),r&&i.queryEventDiscount(),t.sale_fq_list&&(T=t.sale_fq_list,i.renderSaleFeeFqListInfo()),i.renderFee(),"1"==window.G_PAY_TYPE&&i.renderPayment(),i.updateOrderInfo({updateInfoCallBack:function(){window.G_IS_EDIT_SCENE&&!window.G_IS_POCKET_ORDER&&!r&&i.processCheck()}})):w.showError(n,_)},"json","#btn_submit")},queryAddress:function(){var e=this,t="/area/query_address_list.json";$.post(t,{sku_id:$("#sku_id").val()},function(t){var n=parseInt(t.retcode,10),i=t.retmsg;if(0==n){var s=0;b=t.address_list,$.each(b,function(e,t){return 1==t.is_default_address_flag?(s=t.delivery_address_index,!1):void 0}),s||$.isEmptyObject(b)||(s=b[0].delivery_address_index),e.bindAddressWrapEvent(),e.renderAddress(b,s)}else w.showError(n,i)},"json","#btn_submit")},queryUserDiscount:function(){var e="/user/query_user_discount.json",t={sku_id:window.G_SKU_ID,amount:0==window.G_CHARGE_FACE_AMOUNT?window.G_PAY_AMOUNT:window.G_CHARGE_FACE_AMOUNT,order_type:window.G_ORDER_TYPE,stat_channel:"PC"},n=this;$.post(e,t,function(e){var t=parseInt(e.retcode,10),i=e.retmsg;0==t?n.renderUserDiscount(e.result_rows):w.showError(t,i)},"json","#btn_submit")},queryEditSceneDiscountInfo:function(){var e=this,t="/user/query_edit_scene_discount.json",n={udiscount_id:window.G_EDIT_SCENE_DISCOUNT_ID};$.post(t,n,function(t){var n=parseInt(t.retcode,10),i=t.retmsg,s=t.user_discount;0==n?$.isEmptyObject(s)||($.isArray(s.fq_num)&&e.disableFqNum(s.fq_num,!0),R[window.G_FQ_NUM]={serviceFeeDiscount:s.service_fee_discount,manageFeeDiscount:s.manage_fee_discount,handlingFeeDiscount:s.handling_fee_discount,feeDiscountType:s.fee_discount_type},e.showUsedDiscountInfo(s.fee_discount_desc),e.queryFeeList(0)):w.showError(n,i)},"json")},showUsedDiscountInfo:function(e){var t=$(".js-user-discount"),n=$("#user_discount_wrap"),i=$("#pocket_discount_name");i.removeClass(d).text(e),n.addClass(d),t.removeClass(d)},hasPocketDiscount:function(){return window.G_IS_POCKET_ORDER&&!$.isEmptyObject(R)?!0:!1},getCurrentFeeDiscountInfo:function(){return R[window.G_FQ_NUM]||{}},queryEventDiscount:function(){var e,t=this,n="/trade/get_discount_fee.json",i="",s="",o="",_="",a="",r=t.getCurrentFeeDiscountInfo();""!==$("#user_discount_select").val()&&G&&y&&(this.hasPocketDiscount()?(i=r.fee_discount_type,s=r.service_fee_discount,o=r.manage_fee_discount,_=r.handling_fee_discount,a=r.separate_discount_num):(i=G_MERCH_EVENT[window.G_FQ_NUM].fee_discount_type,s=G_MERCH_EVENT[window.G_FQ_NUM].service_fee_discount),e={fee_category_id:G,fee_id:y,fp_ratio:window.G_FP_RATIO,is_balloon_pay:window.G_IS_BALLOON_PAY?1:0,amount:window.G_PAY_AMOUNT,discount_amount:m,discount_type:h,firstpay:0,fq_num:window.G_FQ_NUM,fee_discount_type:i,separate_discount_num:a,service_fee_discount:s,manage_fee_discount:o,handling_fee_discount:_},$.post(n,e,function(e){{var n=parseInt(e.retcode,10),i=e.retmsg;e.result_rows}0==n?t.hasPocketDiscount()&&t.renderPocketEventInfo(e):w.showError(n,i)},"json","#btn_submit"))},queryIsSetBillDay:function(){var e="/user/query_is_set_bill_day.json";$.post(e,function(e){var t=parseInt(e.retcode,10),n=e.retmsg,s="";0==t?e.result_rows.is_set_bill_day?A=!0:(s=i("bill_day_tpl",e.result_rows),$("#bill_day_wrap").html(s).removeClass(d),$("#bill_day_select").combobox("rebuild")):w.showError(t,n)},"json","#btn_submit")},queryIsShowAgent:function(){var e="/trade/query_is_show_agent.json",t={order_type:window.G_ORDER_TYPE,sale_type:window.G_SALE_TYPE,sku_id:window.G_SKU_ID};$.post(e,t,function(e){var t=parseInt(e.retcode,10),n=e.retmsg;0==t?e.is_show_agent&&($("#show_agent").removeClass(d),$("#agent").val(window.G_AGENT),$("#agent_text").text(window.G_AGENT),$("#show_agent").text(window.G_AGENT?"修改":"请填写推荐号")):w.showError(t,n)})},queryOrderScene:function(e){var t="/trade/query_order_scene.json",n=this,i={order_id:window.G_ORDER_ID};$.extend(i,e),$.post(t,i,function(e){var t=parseInt(e.retcode,10),i=e.retmsg;0==t?n.checkOrderScene(e):w.showError(t,i)},"json","#btn_submit")},queryIsAbleOrder:function(){var e="/auth/verify_order.json",t={sku_list:C},n=this;$.post(e,t,function(e){var t=parseInt(e.retcode,10),i=e.retmsg;0==t?(n.isCheckAbleOrder=!0,n.processCheck()):(n.hideLoadingMask(),w.showError(t,i))},"json","#btn_submit")},createOrder:function(){var e="/trade/create_order.json",t=this,n={sku_list:C,common_data:D,include_import_goods:window.G_INCLUDE_IMPORT_GOODS,is_pop_driving_school_order:window.G_IS_POP_DRIVING_SCHOOL_ORDER?1:0,stat_channel:"PC"};return A||C[0].bill_day?void $.post(e,n,function(e){var n=parseInt(e.retcode,10),i=e.retmsg;0==n?(window.G_ORDER_ID=e.order_id,t.showLoadingMask(),t.queryCreateOrderResult()):w.showError(n,i)},"json","#btn_submit"):(w.showMsg({icon:"i-warn",retmsg:"请设置账单还款日",button:[{id:"ok",value:"确定",className:"",display:!0,disabled:!1,handler:function(){t.queryIsSetBillDay(),this.hide()}}]}),!1)},showLoadingMask:function(){$("body").append($("#loading_tmpl").html())},hideLoadingMask:function(){$("#loading_show").remove()},updateCommonData:function(){D=O.serializeObject(),D.receiver_credit_id=S},updateOrderInfo:function(e){e=$.extend({updateInfoCallBack:function(){}},e),C[0]=g.serializeObject(),this.updateCommonData(),e.updateInfoCallBack()},renderAddress:function(e,t){var n=$("#address_list"),s=i("address_wrap_tpl",{address_list:e});n.html(s),t&&n.find("[data-index="+t+"]").trigger("click")},renderEditAddressFrame:function(e){var t=this;o.loadFrame({url:"//pay.fenqile.com/user/address.html",query:{address_index:e},ready:function(){var e=this;e.watchMethod({method:"address_update",callback:function(n,i){$.each(b,function(e,t){return t.delivery_address_index==n.delivery_address_index?(b[e]=n,!1):void 0}),t.renderAddress(b,n.delivery_address_index),i(),e.close()}}),e.watchMethod({method:"address_add",callback:function(n,i){E=1,b.push(n),t.renderAddress(b,n.delivery_address_index),i(),e.close()}})}})},renderUserDiscount:function(e){var t="",n=$("#user_discount_select"),s=$("#user_discount_wrap");F=e.fee_discount_list,e.is_able_discount_flag||e.is_able_exp_flag?(t=i("user_discount_tpl",e),n.html(t).combobox("rebuild"),$(".js-user-discount, .js-last-amount").removeClass(d),window.G_PAY_AMOUNT=e.default_discount.last_amount||window.G_PAY_AMOUNT,s.removeClass(d),this.selectMaxUserDiscount(),this.renderLastAmount(window.G_PAY_AMOUNT)):s.addClass(d)},disableFqNum:function(e,t){var n=$(".js-fq-num-option"),i=n.first().data("disable-cls"),s=parseInt(window.G_FQ_NUM,10);if($.isArray(e))if(n.removeClass(i),t&&n.addClass(i),$.each(e,function(){var e=n.filter("#fq_num_"+this);t?e.removeClass(i):e.addClass(i)}),t&&-1==$.inArray(s,e)){for(var o=0;o<e.length;o++)if($("#fq_num_"+e[o]).length>0){$("#fq_num_"+e[o]).trigger("click");break}}else-1!=$.inArray(s,e)&&n.last().trigger("click")},renderLastAmount:function(e,t){"undefined"!=typeof e&&($("#last_amount").text(e),$("#last_amount_wrap").removeClass(d)),"undefined"!=typeof t&&$("#shipping_cost").text(t)},renderFee:function(){var e=this,t=e.getCurFee(),n=e.hasPocketDiscount(),s="";if(!$.isEmptyObject(t)){window.G_PAY_AMOUNT=t.amount,$("#last_amount").text(t.amount),$("#firstpay").val(t.firstpay),$("#first_amount_pay").html(0==window.G_FP_RATIO?"":'首付<em class="c-red">'+t.firstpay+"元</em>"),T&&T[window.G_FQ_NUM]&&T[window.G_FQ_NUM].fee_discount_rate&&(s=T[window.G_FQ_NUM].fee_discount_rate);var o=i("mon_fee_tpl",{fq_num:window.G_FQ_NUM,is_pocket_order:window.G_IS_POCKET_ORDER,mon_pay:t.mon_pay,handling_fee:t.handling_fee,manage_fee:t.manage_fee,is_pocket_event_order:n,sales_fee_text:s});$("#mon_fee_wrap").html(o),e.updateOrderInfo()}},renderPocketEventInfo:function(e){var t=$("#pocket_discount_info"),n=$("#pocket_discount_amount");$.isEmptyObject(e)||""===e.result_rows[0].total_fee_discount?t.addClass(d):(n.html(e.result_rows[0].total_fee_discount+"元"),t.removeClass(d))},renderAgent:function(){seajs.use(["~escape@1"],function(e){var t=i("agent_code_tpl",{agentCode:$("#agent").val()});w.show({title:"填写代理码",content:t,width:400,button:[]}),$("#agent_wrap").find(".js-confirm").on("click",function(){var t=e.html($("#agent_wrap").find(".js-agent-code").val());$("#agent").val(t),$("#agent_text").text(t?t:""),$("#show_agent").text(t?"修改":"请填写推荐号"),w.hide(),FQL.Stat.clickStat("AGENT_CONFIRM")}),$("#agent_wrap").find(".js-agent-code").on("input",function(){var e=/[\u4E00-\u9FA5\uF900-\uFA2D]/;e.test($(this).val())&&$(this).val("")})})},renderRepayListWrap:function(e){var t=!1,n=e.repay_list;$.each(n,function(e,n){return 0!=n.manage_fee?(t=!0,!1):void 0}),seajs.use(["//cres2.fenqile.cn/pay/css/bill/refund_detail--f7e3adf5a2.css"],function(){var e=i("repay_list_tpl",{repayList:n,is_show_manage_fee:t,fq_num:window.G_FQ_NUM,is_pocket_order:window.G_IS_POCKET_ORDER,is_show_handling_fee:window.G_IS_POCKET_ORDER,is_show_pocket_fee_tip:k});w.show({title:"还款详情",content:e,width:600,button:[]}),$("#repay_list_wrap").find(".js-close").on("click",function(){w.hide()})})},renderSubmitBtn:function(e){var t=$("#btn_submit"),n=t.data("disable-cls");e?t.removeClass(n).prop("disabled",!1):t.addClass(n).prop("disabled",!0)},selectMaxUserDiscount:function(){var e=$("#user_discount_select"),t=e.find(".js-discount-option"),n=P.firstMax(t,function(){return parseFloat($(this).data("discount")||0)});n&&e.val($(n).val()).trigger("render").trigger("change")},saveCustomerMessage:function(){var e=$("#customer_message");if(0!=e.length&&e.val()){var t="/trade/save_customer_message.json",n={memo:e.val(),order_id:window.G_ORDER_ID};$.post(t,n,function(){})}},checkCanSubmitDriveOrder:function(){var e="/trade/check_submit_drive_order.json",t={extra_delivery_credit_id:$("#credit_id").val(),sku_id:$("#sku_id").val(),order_type:window.G_ORDER_TYPE,sale_type:window.G_SALE_TYPE},n=this;$.post(e,t,function(e){var t=parseInt(e.retcode,10),i=e.retmsg;0==t?n.updateOrderInfo({updateInfoCallBack:function(){n.processCheck()}}):w.showMsg({title:"提示",icon:"i-warn",retmsg:i})},"json","#btn_submit")},queryWangYiGameRole:function(){var e="/trade/query_wangyi_game_role.json",t={account:$("#account").val()},n=this;$.post(e,t,function(e){var t=e.retcode,i=e.retmsg;if(0==t)w.showMsg({title:"提示",icon:"i-warn",retmsg:"您将要购买"+$("#product_name").val()+"将会发货到以下角色账户中，请确认</br>角色名:"+e.name,button:[{id:"cancel",value:"取消",className:"btn-gray btn-lg",handler:function(){this.hide()}},{id:"ok",value:"确认，下一步",className:"btn-lg",handler:function(){n.updateOrderInfo({updateInfoCallBack:function(){n.processCheck()}}),this.hide()}}]});else{var s="确定",o=0;(36001204==t||36001203==t)&&(s="重新输入",o=1),w.showMsg({title:"提示",icon:"i-warn",retmsg:i,button:[{id:"ok",value:s,className:"btn-lg",handler:function(){o&&$("#account, #account_repeat").val(""),this.hide()}}]})}},"json","#btn_submit")},queryCreateOrderResult:function(){var e=0,t=null,n=1e3,i=this;t=function(){return e+=1,e>10?(i.hideLoadingMask(),void w.showMsg({icon:"i-warn",retmsg:"此过程超过我们的预期，请再次重试下单"})):void $.get("/trade/query_create_order_result.json",{order_id:window.G_ORDER_ID},function(e){var s=parseInt(e.retcode,10),o=e.retmsg;if(0==s)switch(e.order_add_result){case"SUC":i.isCreateOrder=!0,i.renderDisableChangeInfo(),i.saveCustomerMessage(),i.addContractInfo(),i.processCheck(),L.triggerBehaviorDataUpload({order_id:window.G_ORDER_ID,is_new_address:E,is_success:1,sku_id:window.G_SKU_ID});break;case"FAIL":i.hideLoadingMask();var _=window.G_ORDER_ID;window.G_ORDER_ID="",w.showError(e.order_add_result_code,e.order_add_result_info),L.triggerBehaviorDataUpload({order_id:_,is_new_address:E,is_success:0,sku_id:window.G_SKU_ID});break;default:setTimeout(t,n)}else w.showError(s,o)},"json","#btn_submit")},setTimeout(t,n)},addContractInfo:function(){$.post("/trade/add_contract_info.json",{order_id:window.G_ORDER_ID},function(){})},renderDisableChangeInfo:function(){$("#address_list").addClass("js-disabled"),$("#user_discount_wrap, #deliver_address_wrap").addClass("fui-combobox-disabled")},getFillbackInfo:function(){var e=this,t={sale_type:window.G_SALE_TYPE,sku_id:window.G_SKU_ID},n="/trade/get_extra_fillback_info.json";$.get(n,t,function(t){var n=parseInt(t.retcode,10),i=t.result_rows;0==n&&($("#mobile_mask").val(i.mobile_mask),$("#credit_id_mask").val(i.credit_id_mask),$("#mobile").val(i.mobile),$("#credit_id").val(i.credit_id),$("#qq").val(i.qq),$("#user_name").val(i.user_name),$("#mobile_mask ,#credit_id_mask").on("focus",function(){$(this).addClass(d).next().val("").removeClass(d).focus()}),e.updateOrderInfo())},"json","#btn_submit")},queryAllActivityInfo:function(){{var e=this,t="/trade/query_all_activity_info.json",n={sku_id:$("#sku_id").val(),quantity:$("#quantity").val(),amount:$("#amount").val(),type:{}};String($("#active_flag").val()),$('[name="full_cut_flag"]').val(),$("#full_cut_activity_id").val()}window.G_IS_HAVE_SINGLE_ACTIVITY&&(n.type[window.G_SINGLE_ACTIVITY_FLAG]={sale_type:window.G_SALE_TYPE,sale_index:$("#sale_index").val(),pay_way:window.G_PAY_WAY}),n.type[window.G_FULL_CUT_ACTIVITY_FLAG]={order_type:window.G_ORDER_TYPE},$.post(t,n,function(t){var n,i,s=parseInt(t.retcode,10),o=t.result_rows;0==s&&(n=o.types,i=o.total_amount,$.isEmptyObject(n)||($.isEmptyObject(n[window.G_SINGLE_ACTIVITY_FLAG])||e.renderSingLeActivityInfo(n[window.G_SINGLE_ACTIVITY_FLAG]),$.isEmptyObject(n[window.G_FULL_CUT_ACTIVITY_FLAG])||e.renderFullCutActivityInfo(n[window.G_FULL_CUT_ACTIVITY_FLAG])),window.G_IS_EDIT_SCENE||(f=window.G_PAY_AMOUNT=i)),e.queryFeeList(),window.G_IS_LOGIN&&e.queryUserDiscount()})},renderSingLeActivityInfo:function(e){var t=e.status,n=e.error_info,i=e.active_flag,s=e.single_promotion_type,o=e.single_promotion_amount,_=e.is_single_active_sku,a=e.single_promotion_info,r=a.goods_id||"";_&&(0==t?(G_IS_LOGIN&&$("#price_tip").html(""),window.G_IS_HAVE_SINGLE_ACTIVITY=!0):($("#price_tip").html(n),window.G_IS_HAVE_SINGLE_ACTIVITY=!1)),this.renderSingleInteract({single_promotion_type:parseInt(s,10),price:o,active_flag:i,goods_id:r})},renderSingleInteract:function(e){var t="";switch(e.single_promotion_type){case 1:t="i-act-hui";break;case 2:t="i-act-clock";break;case 3:t="i-act-newb";break;case 4:t="i-act-app";break;case 5:t="i-act-stages"}$("#real_amount").val(e.price),$("#active_flag").val(e.active_flag),$('input[name="goods_id"]').val(e.goods_id),$("#single_icon_tip").addClass(t),$("#price").text(e.price)},renderFullCutActivityInfo:function(e){var t=$("#full_cut_activity"),n=($("#list_item_wrap"),$(".js-user-discount, .js-last-amount"));t.html(e.fe_ex_desc),""!==e.fe_ex_desc?(n.removeClass(d),t.removeClass(d)):t.addClass(d),$("#full_cut_reduce_amount").val(e.reduce_amount),$("#full_cut_flag").val(e.flag),$("#full_cut_activity_id").val(e.active_id),$("#full_cut_active_ids").val(e.full_active_ids)},renderSaleFeeFqListInfo:function(){var e=$("#fee_discount_rate"),t=["event_id","fee_union_flag"];$.isEmptyObject(T)||(T&&T[window.G_FQ_NUM]?$.each(T[window.G_FQ_NUM],function(e,t){$("#"+e).val(t)}):$.each(t,function(e,t){$("#"+t).val("")})),T&&T[window.G_FQ_NUM]&&T[window.G_FQ_NUM].fee_discount_rate?e.text(T[window.G_FQ_NUM].fee_discount_rate).removeClass(d):e.addClass(d)},renderPayment:function(){var e="";window.G_IS_LOGIN&&"1"==window.G_PAY_TYPE&&(window.G_FP_RATIO>0?v?($("#payment_wrap").removeClass(d),$(".js-pay-type-item").first().trigger("click")):$.get("/trade/get_payment.json",{},function(t){v=t,e=i("payment_tpl",{pay_type_cfg:t.pay_type_cfg,bank_list:t.bank_list}),$("#payment_list").html(e),$("#payment_wrap").removeClass(d),$(".js-pay-type-item").first().trigger("click")}):($(".js-pay-type").val("1"),$(".js-bank-type").val(""),$("#payment_wrap").addClass(d)))},bindAddressWrapEvent:function(){var e=$("#address_list"),t=this;e.on("click","#show_all_address",function(){$(this).addClass(d),e.find(".js-item").removeClass(d),FQL.Stat.clickStat("SHOW_ALL_ADDRESS")}),e.on("click","#address_edit",function(){if(e.hasClass("js-disabled"))return w.showMsg({icon:"i-warn",retmsg:"订单生成后，收货地址不能更改哦！"}),!1;var n=$(this).closest(".js-item").data("index");t.renderEditAddressFrame(n),FQL.Stat.clickStat("EDIT_ADDRESS")}),e.on("click",".js-item",function(){if(e.hasClass("js-disabled"))return!1;var t=$(this);e.find(".js-item").removeClass(l),t.addClass(l),$("#delivery_address_index").val(t.data("index"))}),e.on("click","#add_address",function(){t.renderEditAddressFrame(),FQL.Stat.clickStat("ADD_ADDRESS")})},bindEvent:function(){var e=this;g.setInteractiveHandler(function(e){$.each(e.elementList,function(e,t){t.closest(".js-extra-info-item").removeClass(c).find(".js-input-msg").remove()}),$.each(e.errorInfoList,function(e,t){var n='<div class="fl tips js-input-msg">'+t.message+"</div>";t.element.closest(".js-extra-info-item").addClass(c).append(n)})}),$("#agreement").on("click",function(){e.renderSubmitBtn($(this).prop("checked"))}),$("#fq_ratio_select").on("change",function(){window.G_ORDER_ID&&(window.G_IS_NEED_UPDATE_ORDER_INFO=!0),window.G_FP_RATIO=$(this).val(),$("#fp_ratio").val(window.G_FP_RATIO),e.renderPayment(),e.checkIsNeedQueryFee(),window.G_FP_RATIO>0&&FQL.Stat.clickStat("SELECT_FIRST_PAY")}),$(".js-fq-num-option").on("click",function(){var t=$(this),n=t.data("on-cls"),i=t.data("disable-cls");t.hasClass(i)||(window.G_ORDER_ID&&(window.G_IS_NEED_UPDATE_ORDER_INFO=!0),window.G_FQ_NUM=t.data("fq-num"),$("#fq_num").val(window.G_FQ_NUM),window.G_REPAY_TYPE=t.data("repay-type"),$("#repay_type").val(window.G_REPAY_TYPE),t.siblings("span").removeClass(n),t.addClass(n),e.checkIsNeedQueryFee(),window.G_IS_ACTIVE_FEE_FREE&&(window.G_FQ_NUM<=12?$("#fee_free_tips").removeClass(d):$("#fee_free_tips").addClass(d)),e.renderSaleFeeFqListInfo(),e.hasPocketDiscount()&&e.queryEventDiscount())}),$("#user_discount_select").on("change",function(){var t=$(this.options[this.selectedIndex]),n=t.val(),i=[];""===n&&e.disableFqNum([],!1),4==t.data("discount-type")||8==t.data("discount-type")?($.each(F,function(e,t){"d_"+n==e&&(R=t,$.each(t,function(e){i.push(e)}))}),e.disableFqNum(i,!0)):R={},e.renderPocketEventInfo(),window.G_EXP_GOLD="1"==t.attr("data-is-exp")?1:0,window.G_EXP_GOLD?(e.disableFqNum([0,3],!0),k=!1,$("#pocket_fee_tip").addClass(d)):(k=window.G_IS_SHOW_POCKET_FEE_TIP,k&&$("#pocket_fee_tip").removeClass(d)),$("#experience_gold").val(window.G_EXP_GOLD),t.hasClass("js-discount-option")?(m=t.data("discount"),p=n,h=t.data("discount-type")):(m=0,p=0,h=0),$("#discount_id").val(p),$("#discount_type").val(h),$("#discount_amount").val(m),t.hasClass("js-0-fq-only")&&e.disableFqNum([0],!0),t.hasClass("js-fq-only")&&e.disableFqNum([0],!1),e.queryFeeList()}),$("#btn_submit").on("click",function(){var t={};return window.G_IS_POCKET_ORDER?t=N:1==G_IS_FORBIDDEN_TO_ORDER?t={title:"该商品仅支持移动端购买，扫描二维码可使用手机购买",tip:"",url:"http://chong.m.fenqile.com/game/list.html"}:1==window.G_IS_GUIDE_TO_MOBILE&&(t={title:"该商品仅支持移动端购买，扫描二维码可使用手机购买",tip:"扫描上方二维码进入手机端，登录后购买",url:"http://buy.m.fenqile.com/trade/buy/"+window.G_SKU_ID+".html"}),$.isEmptyObject(t)?window.G_IS_LOGIN?$(".js-extra-info-item").length>0&&!g.validate()?void 0:(S=window.G_IS_POP_DRIVING_SCHOOL_ORDER?$("#credit_id").val():$("#receiver_credit_id").val(),window.G_IS_EDIT_SCENE||!window.G_IS_NEED_DELIVERY_ADDRESS||$("#delivery_address_index").val()?!window.G_IS_SHOW_CONFIRM||window.G_IS_EDIT_SCENE||window.G_IS_HAVE_SINGLE_ACTIVITY?window.G_IS_WY_ACCOUNT?void e.queryWangYiGameRole():void e.updateOrderInfo({updateInfoCallBack:function(){e.processCheck()}}):void w.showMsg({title:"提示",icon:"i-warn",retmsg:$("#confirm_tmpl").html(),button:[{id:"cancel",value:"修改",handler:function(){this.hide()}},{id:"ok",value:"确定",handler:function(){window.G_IS_DRIVING_SCHOOL_ORDER?e.checkCanSubmitDriveOrder():e.updateOrderInfo({updateInfoCallBack:function(){e.processCheck()}}),this.hide()}}]}):void w.showMsg({title:"提示",icon:"i-warn",retmsg:"您还没选择收货地址哦~"})):void seajs.use(["~login@1"],function(e){e.show()}):(e.showQrBox(t),!1)}),$("#show_agent").on("click",function(){e.renderAgent(),FQL.Stat.clickStat("SHOW_AGENT")}),$("#mon_fee_wrap").on("click","#repay_list_tip",function(){e.queryFeeList(1),FQL.Stat.clickStat("SHOW_REPAY_LIST")}),$("#loan_protocol").on("click",function(e){e.preventDefault(),w.showIframe({title:"借款服务相关合同",width:400,height:200,url:"/protocol/protocol_box/"+window.G_SKU_ID+".html?action=view"}),FQL.Stat.clickStat("POCKET_PROTOCOL")}),$("#cash_active_tip").on("click",function(){w.showMsg({icon:"i-warn",retmsg:"首次取现用户，免息额度使用上限提升至3000元，有效期截止11月30日，快去体验吧！"})}),$("#payment_list").on("click",".js-pay-type-item",function(){var e=$(this);$(".js-pay-type-item").removeClass(u),e.addClass(u),$(".js-pay-type").val(e.data("pay-type")),$(".js-bank-type").val(e.data("bank-type"))}),$(".js-login").on("click",function(){seajs.use(["~login@1"],function(e){e.show()})}),window.G_IS_SHOW_POCKET_FEE_TIP&&seajs.use(["~tooltip@1"],function(e){new e("#pocket_fee_tip",{content:"您已享受费率折扣",placement:"top"})}),$("#user_imei_select").on("change",function(){var t=$(this),n=$(this.options[this.selectedIndex]),i=$("#imei_sku_tips"),s=$("#imei"),o=$("#associated_order");""!=t.val()?i.html(n.data("product-info")+" 您将为该手机购买碎屏保障。可通过手机“设置”->“本机信息”中找到实际信息进行核对。若IMEI号以“jd_imei”开头，仅核对手机型号即可。"):(i.html("您当前没有可以购买碎屏险的手机"),e.renderSubmitBtn(!1)),s.val(t.val()),o.val(n.data("order-id")),i.removeClass(d)})},showQrBox:function(e){var t=i("qr_box_tpl",e);w.show({title:"扫一扫，前往手机端",content:t,button:[]})},initParams:function(){var e=this;if(window.G_MAIN_FORM=g=new _("#main_form"),O=new _("#common_form"),1==G_IS_FORBIDDEN_TO_ORDER){var t={title:"该商品仅支持移动端购买，扫描二维码可使用手机购买",tip:"",url:"http://item.m.fenqile.com/"+window.G_SKU_ID+".html"};return e.showQrBox(t),!1}e.queryIsLogin(function(){if(window.G_IS_EDIT_SCENE){if(e.showLoadingMask(),e.renderDisableChangeInfo(),e.queryAllActivityInfo(),window.G_EXP_GOLD&&e.disableFqNum([0,3],!0),window.G_IS_POCKET_ORDER)return e.showQrBox($.extend(N,{url:"http://order.m.fenqile.com/order/detail/"+window.G_ORDER_ID+".html"})),void e.hideLoadingMask();window.G_IS_POCKET_ORDER&&window.G_EDIT_SCENE_DISCOUNT_ID&&e.queryEditSceneDiscountInfo()}else e.queryIsSetBillDay(),window.G_IS_HAVE_SINGLE_ACTIVITY||e.queryUserDiscount(),window.G_IS_NEED_DELIVERY_ADDRESS&&($("#address_wrap").removeClass(d),e.queryAddress()),window.G_FP_RATIO&&$("#fq_ratio_select").trigger("change"),(window.G_IS_POP_DRIVING_SCHOOL_ORDER||window.G_IS_DRIVING_SCHOOL_ORDER||window.G_IS_CONCERT_ORDER||window.G_IS_CARD_ORDER||window.G_IS_INSURANCE_ORDER)&&$(".js-extra-info-item").length>0&&e.getFillbackInfo(),window.G_IS_INSURANCE_ORDER&&$("#user_imei_select").trigger("change");e.queryIsShowAgent()}),$("#pocket_desc").val(s.get("desc")),e.updateOrderInfo(),window.G_IS_ACTIVATE_ORDER||window.G_IS_EDIT_SCENE||e.queryAllActivityInfo()},sendSpeed:function(){seajs.use(["~speed@1"],function(e){new e({domainId:6,pageId:1,timePoint:G_SPEED_POINT_TIME})})},bindError:function(){var e=FQL.ErrorLogger.getLogger("trade_buy");e.bindError("910520000")},init:function(){G_SPEED_POINT_TIME.LOGIC={ID:5,DATA:[G_PAGE_LOAD_TIME,(new Date).getTime()]},this.initParams(),this.bindEvent(),this.sendSpeed(),this.bindError()}},P={firstMax:function(e,t){if(!e.length)return void 0;var n=Number.NEGATIVE_INFINITY,i=null;return $.each(e,function(e,s){var o=t.apply(s,arguments);o>n&&(n=o,i=s)}),i}};j.init()});
//# sourceMappingURL=//pay.fenqile.com/res/static/trade/buy.js.map