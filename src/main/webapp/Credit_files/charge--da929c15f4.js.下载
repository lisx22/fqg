seajs.use(["~combobox@1","~form@1","~login@1","~storage@1","~strtool@1","~box@1","~format@1","//cres1.fenqile.cn/chong/static/fragment/check_gray_user--8ff4912f22.js"],function(e,t,a,s,i,l,o,n){var r="on",u="btn-disabled",c="is-disabled",m="ui-self-on",d="hide",_={},h="",f=0,v=0,p="",g="",b="",k=new l,C=$("#input_mobile"),j={mobile:{"null":"请输入手机号码",error:"手机号码格式错误"}},I={querySkuList:function(){var e=this,t="/phone/get_charge_phone_sku_list.json",a=e.replaceBlank(C.val()),s={mobile:a};return $("#charge_btn").addClass(u),!a||a.length<11?void 0:_&&_[a]?(e.renderSkuList(_[a]),h=_[a].callerloc,void e.renderCallerloc()):void $.post(t,s,function(t){var s=t.retcode,i=t.retmsg;1==t.is_isp_limit_exist?(h=t.callerloc,k.showError(t.isp_info),e.disabledBtn()):0==s?(e.enableBtn(),_[a]=t,e.renderSkuList(t),h=t.callerloc):(h="",k.showError(s,i)),e.renderCallerloc()})},initUserinfo:function(){var e=this,t="/phone/query_charge_phone_user_info.json";$.post(t,{},function(t){var a=t.retcode;0==a&&(f=t.is_login,p=t.binding_mobile,h=t.callerloc,t.last_charge_phone_mobile?(g=t.last_charge_phone_mobile,b=t.last_charge_phone_callerloc):(g=p,b=h),e.loginCallback())})},enableBtn:function(){$(".js-amount-item").removeClass(c)},disabledBtn:function(){$(".js-amount-item").addClass(c)},renderSkuList:function(e){var t=$(".js-more-wrap"),a=$("#more_txt"),s=$(".js-more-amount-ul"),l=$("#charge_btn"),o=$("#amount_area"),n=$("#tpl_amount_item").html(),c=i.substitute(n,e.sku_list),_=this;if(e.hide_sku_list&&e.hide_sku_list.length>0)if(1==e.hide_sku_list.length)c+=i.substitute(n,e.hide_sku_list);else{var h=i.substitute($("#tpl_more_amount_item").html(),e.hide_sku_list);s.html(h),t.removeClass(d),t.removeClass(m),a.text(a.data("more-txt"))}else t.addClass(d);if($(".js-amount-ul").html(c),$('.js-amount-item[data-sku-id="'+e.default_sku_id+'"]').addClass(r),G_SKU_ID=e.default_sku_id,0==e.sku_list.length){var f=$(".js-input-mobile-msg"),v="暂不支持此手机号码的充值",g=_.replaceBlank(C.val());l.addClass(u),o.addClass(d),g==p&&(v="暂不支持此账号绑定手机号码充值"),f.html(v).removeClass(d)}else l.removeClass(u),o.removeClass(d)},renderCallerloc:function(){var e=$("#binding_mobile_text"),t=$("#callerloc_area"),a=this.replaceBlank(C.val());e.addClass(d),t.addClass(d),""!==p&&a==p&&e.removeClass(d),h&&(t.removeClass(d),$("#callerloc_txt").html(h))},delay:function(e,t){if("function"!=typeof e)return e;var a=null;return function(){null!=a&&clearTimeout(a);var s=this,i=arguments;a=setTimeout(function(){a=null,e.apply(s,i)},t)}},loginCallback:function(){var e=$(".js-more-wrap"),t=$(".js-amount-item"),a=$("#more_txt"),i=s.getItem("charge_mobile"),l=s.getItem("selected_sku"),o=s.getItem("select_more");if(!i){var n=this.replaceBlank(C.val());if(f&&""==n){var u=this.formatMobile(n);C.val(u),this.querySkuList()}return!1}var c=this.formatMobile(i);if(C.val(c),g=i,s.removeItem("charge_mobile"),l)if(G_SKU_ID=l,t.removeClass(r),s.removeItem("selected_sku"),o&&1==o){var d=$(".js-more-amount-item[data-sku-id="+l+"]").data("text");e.addClass(m),a.text(d)}else $(".js-amount-item[data-sku-id="+l+"]").addClass(r);o&&s.removeItem("select_more"),this.querySkuList()},goNext:function(){var e="/phone/get_charge_phone_sale_index.json",t={sku_id:G_SKU_ID,recharge_mobile:this.replaceBlank(C.val())};$.post(e,t,function(e){var t=e.retcode,a=e.retmsg;0==t?e.result_rows.sale_index&&(FQL.Stat.clickStat("BTN_RECHARGE_PHONE_"+G_SKU_ID),window.location.href="//pay.fenqile.com/trade/buy/0/"+v+"/1/"+e.result_rows.sale_index+"/"+G_SKU_ID+".html"):k.showError(t,a)})},isActiveAutoCharge:function(){var e="/phone/check_use_auto_charge.json",t={};$.post(e,t,function(e){{var t=e.retcode;e.retmsg}if(0==t){var a=(e.is_active,e.has_active);if(1==a){var s=$("#is_auto_charge_text");s.html(s.data("active-text"))}if(1==a){var i=$(".js-set-auto-charge");i.unbind("click"),i.on("click",function(e){e.preventDefault(),location.href=$("#is_auto_charge_text").data("list-url")})}}})},formatMobile:function(e){return e=o.formatMobile(e)},replaceBlank:function(e){return e=e.replace(/\s+/g,"")},bindEvent:function(){var e=this,t=$("body"),i=$(".js-more-wrap"),l=$("#more_txt"),o=$(".js-input-mobile-msg"),_=$("#charge_btn"),v=$(".js-set-auto-charge");C.on("input",e.delay(function(){var t=e.replaceBlank(C.val());_.addClass(u),h="",11==t.length?(o.addClass(d),e.valid.validate()?e.querySkuList():e.renderCallerloc()):e.renderCallerloc()},1e3)),C.on("input",function(){var t=C.val(),a=e.formatMobile(t);C.val(a)}),C.on("keydown",function(e){13!=e.keyCode&&_.addClass(u)}),C.on("focus",function(){var t=e.replaceBlank(C.val());""!==p&&t==p&&(C.val(""),_.addClass(u),h="",e.renderCallerloc())}),C.on("blur",function(t){t.preventDefault();var a=e.replaceBlank(C.val());if(""!==p&&""==a){var s=e.formatMobile(g);C.val(s),e.querySkuList()}}),t.on("click",".js-amount-item",function(){var e=$(this);e.hasClass(c)||($(".js-amount-item").removeClass(r),e.addClass(r),G_SKU_ID=e.data("sku-id"),i.removeClass(m),l.text(l.data("more-txt")))}),t.on("click",".js-more-amount-item",function(){var e=$(this),t=e.data("denomination"),a=e.data("amount");e.hasClass(c)||(G_SKU_ID=e.data("sku-id"),l.html('<span class="js-more-flow m-num">'+t+'</span><span class="pos-bot2 js-more-amount">'+a+"</span>"),i.addClass(m),$(".js-amount-item").removeClass(r))}),_.on("click",function(t){if(t.preventDefault(),$(this).hasClass(u))return!1;if(o.addClass(d),!e.valid.validate())return!1;if(!f){var l=0;i.hasClass(m)&&(l=1);var r=e.replaceBlank(C.val());return s.setItem("charge_mobile",r),s.setItem("selected_sku",G_SKU_ID),s.setItem("select_more",l),void a.show()}new n({id:"tpl_qrcode_box",url:"http://chong.m.fenqile.com/phone/charge.html",hottag:"CHONG.PHONE.CHARGE.QRCODE_TRANSFORM",func:e.goNext,content:e})}),v.on("click",function(){if(!f){return void a.show()}k.showIframe({title:"编辑充值号码",width:640,height:700,url:"/phone/auto_charge.html"})})},sendSpeed:function(){seajs.use(["~speed@1"],function(e){new e({domainId:14,pageId:1,timePoint:G_SPEED_POINT_TIME})})},initForm:function(){[{id:"#input_mobile",type:"mobile",msg:j.mobile}];this.valid=new t("#charge_form"),this.valid.validate()},initParam:function(){this.initUserinfo(),this.isActiveAutoCharge(),this.initForm(),""==C.val()&&C.focus()},init:function(){this.initParam(),this.bindEvent(),G_SPEED_POINT_TIME.LOGIC={ID:5,DATA:[G_PAGE_LOAD_TIME,(new Date).getTime()]},this.sendSpeed()}};I.init()});
//# sourceMappingURL=//chong.fenqile.com/res/static/phone/charge.js.map